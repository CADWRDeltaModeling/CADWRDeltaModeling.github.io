<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : Tutorial 3: Layering</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_87228717.html">Tutorials</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : Tutorial 3: Layering
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><strong>Task</strong></p><ul><li>Separate DSM2 input data into multiple input files</li><li>Use layers in DSM2 to group related items</li></ul><p><br class="atl-forced-newline"/><strong>Skills Gained</strong><span> </span><br/>Learn how to use layering in DSM2 to add, change and delete features in a DSM2 simulation, for example including a new reservoir in a simulation</p><p>The purpose of this tutorial is to demonstrate the use of layering to structure your project. Layers are part of the DSM2 data management system. They allow input items to be grouped in logical bundles, and allow changes to be brought into an old simulation without erasing or altering archived items. At the same time we will neaten up our input by dividing it into several files that are &quot;included&quot; from a fairly sparse primary file. The layering concept will be demonstrated by adding a &quot;dummy&quot; reservoir connected to nodes 5 and 6 (Figure 1) that will be &quot;turned on&quot; or &quot;turned off&quot; in a simulation. We will also use DSM2MODIFIER to differentiate between alternative simulations.<br/><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="385" width="623" src="attachments/5931250/5931249.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddavd56eb5f63f4c9181cb2a8632c8c6c562.png?version=1&amp;modificationDate=1496695513030&amp;api=v2"></span></span><strong>dummy_res</strong><br/><strong>Figure 1:</strong><span> </span><strong>Simple channel with a reservoir, gate, flow transfer and dummy reservoir.</strong></p><ol><li><strong>Convert the previous hydro.inp GRID items to external files</strong></li></ol><p>In order to use layers, the input tables have to be gathered into individual input files.<span> </span><br/><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>Key points about layering:</p><ul><li>Each file represents a layer</li><li>Information in the launch file (<em>hydro.inp</em><span> </span>or<span> </span><em>qual.inp</em>) supercedes all other input information.</li><li><strong><em>For include blocks, files that are read later replace files that are read earlier</em></strong>, in other words, if the same type of input information exists in more than one file, the last information read will overwrite the previously read values.</li><li>Overriding values is based on an identifier (e.g.NAME or NAME and VARIABLE—identifiers are listed in table reference documentation)</li><li>Parent and child tables (e.g. channel and xsect) must be grouped in the same file.</li><li>If a parent item is overridden, all of the child items associated with the overridden parent item are ignored.<ol><li>Move the channel and reservoir data:<ol><li>Navigate to the t3_layering directory.</li><li>Create a new file in Notepad++ called<span> </span><em>grid_tutorial_base.inp</em></li><li>Open<span> </span><em>hydro.inp</em>.</li><li>Locate the CHANNEL and XSECT_LAYER tables in<span> </span><em>hydro.inp</em>.<span> </span><strong>Cut</strong><span> </span>them and paste them into<span> </span><em>grid_tutorial_base.inp.</em></li><li>Locate the RESERVOIR and RESERVOIR_CONNECTION tables in<span> </span><em>hydro.inp</em>.<span> </span><strong>Cut</strong><span> </span>them and paste them into<span> </span><em>grid_tutorial_base.inp</em><span> </span>and save the file. Note: leave the RESERVOIR_IC in the<span> </span><em>hydro.inp</em><span> </span>file.</li><li>Similarly move the TRANSFER and GATE information from<span> </span><em>hydro.inp</em><span> </span>to<span> </span><em>grid_tutorial_base.inp</em>.<span> </span><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>Be sure to move the GATE child tables too. Leave the INPUT_TRANSFER_FLOW table in the<span> </span><em>hydro.inp</em><span> </span>file.</li><li>Make sure the data tables listed above have been removed from<span> </span><em>hydro.inp</em>.</li><li>Now add these lines to<span> </span><em>hydro.inp</em><span> </span>that will tell DSM2 you want to include data from other files and that these files will contain GRID (channel, reservoir, transfer and gate) tables and their child tables. Add the GRID table after the IO_FILE block and before any of the initial condition blocks.</li></ol></li></ol></li></ul><p>GRID<br/>grid_tutorial_base.inp<br/>END<br/><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>Be sure that there is a carriage return at the end of each *.inp file.<span> </span></p><ol><li><strong>Running HYDRO and QUAL with grid information in separate files</strong></li></ol><p>This simulation will serve as the base case for comparison for the other simulations run in this tutorial. We will use the DSM2MODIFIER to differentiate between the various simulations. DSM2MODIFIER is a special ENVVAR definition that is automatically used by DSM2 to mark output (the F Part of the DSS Path).</p><ol><li><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_base and save the files.</li><li>In Windows Explorer, navigate to the directory: _<br class="atl-forced-newline"/><span class="error" style="color: rgb(51,51,51);">Unknown macro: {DSM2_home}tutorialsimple{_}</span><p>.</p><ol><li><ol><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>. Note: for computers running Vista, use a shift+right click on the directory name to get the Open Command Window.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Note that many of output files all use the DSM2MODIFIER in their name, e.g.<span> </span><em>layers_base.out</em>. The<span> </span><em>output.dss</em><span> </span>file distinguishes between scenarios by using the DSM2MODIFIER in the F-Part. Open the<span> </span><em>output.dss</em><span> </span>file in the<span> </span><em>t3_layering</em><span> </span>directory, and examine the results.</li></ol></li></ol><p><br/></p><ol><li><strong>Creating a new reservoir:</strong></li></ol><p>In this section, we will learn how to add a feature by adding a new reservoir. We don't want to mess too much with what we have already, so we are going to add a dummy reservoir in our grid_tutorial_base layer. Later in this tutorial, we will learn how to use layers to disable this feature as well.<span> </span><br/><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>The ability to mask and delete features such as reservoirs and gates in DSM2 is often used in planning runs to &quot;turn on&quot; and &quot;turn off&quot; features when studying planning alternatives.<span> </span></p><ol><li><ol><li><ol><li>Create a new Reservoir in<span> </span><em>grid_tutorial_base</em><ol><li>In tutorial_grid_base.inp, enter data for the new reservoir below the data for res_1</li><li>Name:<span> </span><em>dummy_res</em></li><li>Area (million sq ft):<span> </span><em>60</em></li><li>Bottom elev (ft): -30</li></ol></li></ol></li><li>In the<span> </span><em>Reservoir Connection</em><span> </span>table:<ol><li>Enter the following values into the appropriate fields:<ol><li>Reservoir name: dummy_res</li><li>Node:<span> </span><em>5</em></li><li>Res Coef (in):<span> </span><em>220</em></li><li>Res Coef (out):<span> </span><em>220</em></li></ol></li></ol></li><li>Again, in the<span> </span><em>Reservoir Connection</em><span> </span>table:<ol><li>Enter the following values into the appropriate fields:<ol><li>Reservoir name: dummy_res</li><li>Node:<span> </span><em>6</em></li><li>Res Coef (in):<span> </span><em>220</em></li><li>Res Coef (out):<span> </span><em>220</em></li></ol></li></ol></li><li>Save the current settings.</li></ol></li></ol><p><br/></p><ol><li><strong>Running HYDRO and QUAL with the new reservoir</strong></li></ol><p>This simulation is our first alternative which adds a reservoir. We will use the DSM2MODIFIER to differentiate this simulation from the base simulation.</p><ol><li><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_dummyres and save the files.</li><li>In Windows Explorer, navigate to the directory: _</li></ol></li></ol>.</li><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>. For Vista shift+right click on directory to get the Open Command Window.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Note that many of output files all use the DSM2MODIFIER in their name, e.g.<span> </span><em>layers_dummyres.out</em>. Compare the<span> </span><em>layer_base.out</em><span> </span>and the<span> </span><em>layer_dummyres.out</em>echoed input files to make sure that the dummy reservoir was included in the simulation. The<span> </span><em>output.dss</em><span> </span>file distinguishes between scenarios by using the DSM2MODIFIER in the F-Part. Open the<span> </span><em>output.dss</em><span> </span>file in the<span> </span><em>t3_layering</em><span> </span>directory, and look for results from the base run and from the new dummyres simulation.</li></ol></li><li><strong>Disabling a reservoir using a revision layer</strong></li></ol><p>In this step of the tutorial, we will disable (remove) the dummy reservoir from the simulation using a revision layer. Revision layers allow the user to add or remove features for alternatives without altering the base input files.</p><ol><li><ol><li>Create a Reservoir Revision Layer:<ol><li>Create a file called<span> </span><em>grid_tutorial_revision.inp.</em><span> </span>Add this file to your GRID include-file section in<span> </span><em>hydro.inp</em>, which will now look like this:</li></ol></li></ol></li></ol><p>GRID<br/>grid_tutor<em>ial_base.inp</em><br/>grid_tutor<em>ial_revision.inp</em><br/><em>END</em><br/><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>The include files will be prioritized in the order they are read, later files replacing earlier ones. In this example, the information in<span> </span><em>grid_tutorial_revision.inp</em><span> </span>has priority over<span> </span><em>grid_tutorial_base.inp</em>, thus any duplicate information in<span> </span><em>grid_tutorial_revision.inp</em><span> </span>will override the information in<span> </span><em>grid_tutorial_base.inp</em>. When a parent table identifier (usually a channel/node number or a &quot;name&quot;) is overridden by a later file, its original data (including child tables) will be ignored. Everything will come from the higher priority layer.</p><ol><li><ol><li><ol><li>Copy the reservoir table header and dummy reservoir data from<span> </span><em>grid_tutorial_base.inp</em><span> </span>to<span> </span><em>grid_tutorial_revision.inp</em>. It is important to copy both the parent (RESERVOIR) and the child (RESERVOIR_CONNECTION) tables into the revision layer.</li><li>Add a carat (^ shift and 6 key) before the reservoir name in the parent table. Your entry should look like this:</li></ol></li></ol></li></ol><p>RESERVOIR<br/>NAME AREA BOT_ELEV<br/>^dummy_res 60.0 -30.0<br/>END<span> </span><br class="atl-forced-newline"/>RESERVOIR_CONNECTION<br/>RES_NAME NODE COEF_IN COEF_OUT<br/>dummy_res 5 220.0 220.0<br/>dummy_res 6 220.0 220.0<br/>END</p><ol><li><ol><li>By overriding the name &quot;dummy_res&quot; and also marking it unused, you have now effectively removed dummy_res from the calculations. The child table is automatically ignored as well (so in a sense the entries there are unnecessary).<span> </span><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931252.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddavf9e3aa73957a24bdb115e43494948841.png?version=1&amp;modificationDate=1496695513187&amp;api=v2"></span></span><span> </span>What is the difference between commenting out &quot;dummy_res&quot; in the revision layer and using a carat (^) in the revision layer?<br/><strong>Answer:</strong><span> </span>Commenting out the reservoir in the revision layer will be like the revision never existed and the information from the original grid layer will be used in the simulation.<br/>Using the carat (^) will &quot;turn off&quot; that reservoir for the simulation. Neither the information in the original grid layer or in the revision layer will be used in that simulation. Thus using the carat is a way to &quot;turn on or off&quot; alternative components.</li><li>Save the current settings.</li></ol></li></ol><p><br/></p><ol><li><strong>Running HYDRO and QUAL disabling the new reservoir</strong><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_nodummyres and save the files.</li><li>In Windows Explorer, navigate to the directory: _<br class="atl-forced-newline"/><span class="error" style="color: rgb(51,51,51);">Unknown macro: {DSM2_home}tutorialsimple{_}</span><p>.</p><ol><li><ol><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>. For Vista shift+right click on directory to get the Open Command Window.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Compare the<span> </span><em>layer_base.out</em>,<span> </span><em>layer_dummyres.out, and layer_nodummyres.out</em><span> </span>echoed input files and the<span> </span><em>output.dss</em><span> </span>file. Are the results the same for the base simulation and the no dummy reservoir simulation?</li></ol></li></ol><p><br/></p><ol><li><strong>Changing the properties of a reservoir</strong></li></ol><p>This part of the tutorial demonstrates how a revision layer can be used to change the properties of a simulation. In this case the area of reservoir 1 is increased.</p><ol><li><ol><li>Altering the Properties of the Original Reservoir res_1:<ol><li>In the<span> </span><em>Reservoirs</em><span> </span>table of grid_tutorial_revision.inp, change the<span> </span><em>Area (million sq ft)</em><span> </span>field of res_1 from<span> </span><em>40</em><span> </span>to<span> </span><em>50</em>.</li><li>Copy the RESERVOIR_CONNECTION entries for res_1 from grid_tutorial_base to grid_tutorial_revision. The revision layer should look similar to the one below.</li></ol></li></ol></li></ol><p>RESERVOIR<br/>NAME AREA BOT_ELEV<span> </span><br/>res_1 50.0 -24.0<span> </span><br/>^dummy_res 60.0 -30.0<br/>END<span> </span><br class="atl-forced-newline"/>RESERVOIR_CONNECTION<br/>RES_NAME NODE COEF_IN COEF_OUT<br/>res_1 3 200.0 200.0<span> </span><br/>res_1 4 200.0 200.0<br/>dummy_res 5 220.0 220.0<span> </span><br/>dummy_res 6 220.0 220.0<span> </span><br/>END<span> </span><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931252.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddavf9e3aa73957a24bdb115e43494948841.png?version=1&amp;modificationDate=1496695513187&amp;api=v2"></span></span><span> </span>Why is it necessary to copy the reservoir connection entries to the revision file?<br/><strong>Answer:</strong><span> </span>When you override a layer (file) with another entry in a parent table that has the same identifier, you COMPLETELY replace that item in the new layer including child items. In other words, if the child table-<span style="text-decoration: line-through;">RESERVOIR_CONNECTIONS in this case</span>-is not included in the revision layer, the reservoir will have no connections. The values in the original grid layer will not be read.</p><ol><li><ol><li>Save the current settings.</li></ol></li><li><strong>Running HYDRO and QUAL</strong><span> </span><strong>with increased area for reservoir 1</strong><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_larger_res1 and save the file.</li><li>In Windows Explorer, navigate to the directory: _</li></ol></li></ol>.</li><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>. For Vista shift+right click on directory to get the Open Command Window.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Compare the output to the earlier simulations.</li></ol></li></ol><p><br/></p><ol><li><strong>Changing the name of Channel 2004:</strong></li></ol><p>In this step, we will replace the channel number of Channel 2004. In this case, what we are changing is the identifier itself, rather than the parameters and data. So what we will do is delete Channel 2004 and put in a Channel 4 that is identical. In the process, we will ignore this change in other parts of the input and see what happens to initial conditions and output requests that reference a non-existent channel.</p><ol><li><ol><li>Keep the<span> </span><em>grid_tutorial_revision</em><span> </span>file open.</li><li>Copy the channel and xsect data from<span> </span><em>grid_tutorial_base.inp</em><span> </span>to the beginning of<span> </span><em>grid_tutorial_revision.inp</em>. Keep only channel 2004.</li><li>In<span> </span><em>grid_tutorial_revision.inp</em><span> </span>in the CHANNEL and XSECT tables, copy the data for Channel 2004 and paste another copy into those tables.</li><li>In one of your two copies of channel 2004, change the channel number in both tables to 4.</li><li>Eliminate channel 2004 by prepending a carat in the CHANNEL table. Your revision should look like this:</li></ol></li></ol><p>CHANNEL<br/>CHAN_NO LENGTH MANNING DISPERSION UPNODE DOWNNODE<br/>4 15000 0.035 0.3 4 5<span> </span><br/>^2004 15000 0.035 0.3 4 5<span> </span><br/>END<span> </span><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/>XSECT_LAYER<br/>CHAN_NO DIST ELEV AREA WIDTH WET_PERIM<br/>4 0.5 -24.0 0.0 40.0 40.0<span> </span><br/>4 0.5 0.0 960.0 80.0 91.22<span> </span><br/>4 0.5 20.0 2640.0 160.0 133.6<span> </span><br/>2004 0.5 -24.0 0.0 40.0 40.0<span> </span><br/>2004 0.5 0.0 960.0 80.0 91.22<span> </span><br/>2004 0.5 20.0 2640.0 160.0 133.6<span> </span><br/>END<span> </span></p><ol><li><ol><li>Save your work. Note that the entries in XSECT_LAYER for channel 2004 in the<span> </span><em>grid_tutorial_revision.inp</em><span> </span>are redundant since the channel was disabled. However it is good practice to always include full parent/child table groups in the revision layer so that choices can be turned &quot;on&quot; or &quot;off.&quot;</li></ol></li></ol><p><br/></p><ol><li><strong>Add Initial Conditions for the New<span> </span><em>Channel 4</em>:</strong></li></ol><p>Since there is no default initial condition for channel 4, we will have to add one. Similar to the other channels, we will use a zero flow initial condition.</p><ol><li><ol><li>Create a file called<span> </span><em>channel_ic_revision.inp</em>.</li><li>Copy the CHANNEL_IC table headers from<span> </span><em>hydro.inp</em><span> </span>to the new file.</li><li>Create two rows of data for channel 4:</li></ol></li></ol><p>CHANNEL_IC<br/>CHAN_NO DISTANCE STAGE FLOW<br/>4 0 0.0 0.0<br/>4 length 0.0 0.0<br/>END<span> </span></p><ol><li><ol><li>In the<span> </span><em>hydro.inp</em><span> </span>file create an INITIAL_CONDITION include block underneath the GRID include block:</li></ol></li></ol><p>INITIAL_CONDITION<br/>channel_ic_revision<em>.inp</em><br/><em>END</em></p><ol><li><ol><li>Now every channel has an initial condition. Do you need to do something about the &quot;extra&quot; initial condition for Channel 2004? Try and see.</li></ol></li></ol><p><br/></p><ol><li><strong>Running HYDRO and QUAL</strong><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_ch2004_to_ch4 and save the files.</li><li>In Windows Explorer, navigate to the directory: _<br class="atl-forced-newline"/><span class="error" style="color: rgb(51,51,51);">Unknown macro: {DSM2_home}tutorialsimple{_}</span><p>.</p><ol><li><ol><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Open the<span> </span><em>output.dss</em><span> </span>file in the<span> </span><em>t3_layering</em><span> </span>directory, and examine the results.</li><li>Open<span> </span><em>layers_ch2004_to_ch4_hydro_echo.inp</em>. This is an &quot;echoed input&quot; that replicates your input verbatim, except ENVVAR replacements have been made and all the channel xsects are in the one-file format. You should be able to run the model using this file as easily as with the original hydro.inp. Take a look and see:<ol><li>Did channel 4 get in the input?</li><li>Did channel 2004? What does this mean?</li></ol></li><li>Look at the output.dss file. Did the output for channel 4 get included in the output file? If not, what would you change to get output for channel 4?</li></ol></li></ol><p><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="29" width="29" src="attachments/5931250/5931251.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddave8e1df4e853bb46c4ee6f68afece040d.png?version=1&amp;modificationDate=1496695513062&amp;api=v2"></span></span><span> </span>Only output specified in the input files is written to the output.dss file. However, output for all locations is recorded in the hdf5 *.h5 output file.<span> </span></p><ol><li><strong>Converting hydro.inp to input blocks</strong></li></ol><p>Now let's convert hydro.inp completely to include files except for the SCALAR and IO_FILE sections. In future tutorials, hydro and qual simulations will be organized this way. The file hydro.inp or qual.inp is usually reserved for scalar or input/output file designations.</p><ol><li><ol><li>In the previous section of this tutorial, an INITIAL_CONDITION include block was created underneath the GRID include block. We will create an initial condition input file for the original initial conditions and include that file here. Add the file ic_tutorial.inp as the first line of the INITIAL_CONDITION include block. The<span> </span><em>channel_ic_revision.inp</em><span> </span>file was already included in this block in the previous section of this tutorial.</li></ol></li></ol><p>INITIAL_CONDITION<br/>ic_tutor<em>ial.inp</em><br/>channel_ic_revision<em>.inp</em><br/><em>END</em></p><ol><li><ol><li>Create a file called ic_tutorial.inp</li><li>Cut (not copy) the CHANNEL_IC and RESERVOIR_IC data from<span> </span><em>hydro.inp</em><span> </span>and paste it into this file.</li><li>Create an include block called HYDRO_TIME_SERIES as follows, in<span> </span><em>hydro.inp</em>.</li></ol></li></ol><p>HYDRO_TIME_SERIES<br/>input_boundary_hydro_tutorial.inp<br/>input_transfer_flow_tutorial.inp<br/>END</p><ol><li><ol><li>Create a file called<span> </span><em>input_boundary_hydro_tutorial.inp</em>. Cut (not copy) the BOUNDARY_STAGE and BOUNDARY_FLOW input from<span> </span><em>hydro.inp</em><span> </span>to<span> </span><em>input_boundary_hydro_tutorial.inp</em>.</li><li>Similarly, create a file called input_transfer_flow_tutorial.inp. Cut and paste the INPUT_TRANSFER_FLOW data into this file.</li><li>Create an include block called OUTPUT_TIME_SERIES.</li></ol></li></ol><p>OUTPUT_TIME_SERIES<br/>output_hydro_tutorial.inp<br/>END</p><ol><li><ol><li>Similarly, create the file called output_hydro_tutorial.inp. Cut and paste the OUTPUT_CHANNEL data into this file.</li><li>The remaining tutorials will use include blocks extensively for both hydro and qual.</li><li>Save all of the files.</li></ol></li></ol><p><br/></p><ol><li><strong>Running HYDRO and QUAL with all include files</strong><ol><li>In the ENVVAR section of<span> </span><em>hydro.inp</em><span> </span>and<span> </span><em>qual.inp</em>, change DSM2MODIFIER to layers_include_block</li><li>In Windows Explorer, navigate to the directory: _</li></ol></li></ol>.</li><li>Right-click on the directory,<span> </span><em>t3_layering</em>, and select<span> </span><em>Open Command Window Here</em>.</li><li>In the command window, type:<span> </span><em>hydro hydro.inp</em>.</li><li>In the command window, type:<span> </span><em>qual qual.inp</em>.</li><li>Open the<span> </span><em>output.dss</em><span> </span>file in the<span> </span><em>t3_layering</em><span> </span>directory, and examine the results, comparing it to the last run. Did putting things in input blocks change anything?</li></ol></li><li><strong>Learning more</strong></li></ol><p>Overriding is easy to understand. The main things you will need to keep in mind are</p><ol><li>Understanding how child table replacement works:<ol><li>You can't replace the child element without replacing the parent.</li><li>The children of an overridden parent element are never used.</li></ol></li><li>What is the unique identifier for each row in a table? In most cases this is the first field and it is usually a name or a map number (it is a label rather than a piece of hard data). In some cases (e.g. output), the unique identifier may be two fields such as NAME and VARIABLE for output. Overriding only occurs when the identifier for the row is duplicated. This information is available in the table reference documentation in the &quot;documentation&quot; folder.</li><li>Which data can be included in which blocks. For instance, GRID can contain CHANNEL, GATE, RESERVOIR and TRANSFER data. This information is given in Table 1 on the next page.</li></ol><p><span class="image-wrap"><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-external-resource" height="96" width="82" src="attachments/5931250/5931253.png" data-image-src="http://msb-confluence/download/attachments/5931250/worddavfc12b6cdb26e67dfc2a101ee2af340bd.png?version=1&amp;modificationDate=1496695513307&amp;api=v2"></span></span></p><ol><li><strong>Brain Teaser</strong><ol><li>For the same change in elevation between the reservoir and connecting node, which reservoir would have a higher flow, res_1 or dummy_res?</li></ol></li></ol><p><strong>Table 1: Include Blocks for DSM2 Input Files</strong></p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/></colgroup><tbody><tr><td style="text-align: left;" class="confluenceTd"><p>Include Block</p></td><td style="text-align: left;" class="confluenceTd"><p>Sections</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>CONFIGURATION<span> </span></p></td><td style="text-align: left;" class="confluenceTd"><p>ENVVAR<span> </span><br class="atl-forced-newline"/>SCALAR</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>GRID</p></td><td style="text-align: left;" class="confluenceTd"><p>CHANNEL<span> </span><br class="atl-forced-newline"/>XSECT (child)<span> </span><br class="atl-forced-newline"/>XSECT_LAYER (child)<span> </span><br class="atl-forced-newline"/>RESERVOIR<span> </span><br class="atl-forced-newline"/>RESERVOIR_CONNECTION (child)<span> </span><br class="atl-forced-newline"/>GATE<span> </span><br class="atl-forced-newline"/>GATE_WEIR_DEVICE (child)<span> </span><br class="atl-forced-newline"/>GATE_PIPE_DEVICE (child)<span> </span><br class="atl-forced-newline"/>TRANSFER</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>GROUPS</p></td><td style="text-align: left;" class="confluenceTd"><p>GROUP<span> </span><br class="atl-forced-newline"/>GROUP_MEMBER (child)</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>HYDRO_TIME_SERIES</p></td><td style="text-align: left;" class="confluenceTd"><p>INPUT_TRANSFER_FLOW<span> </span><br class="atl-forced-newline"/>INPUT_GATE<span> </span><br class="atl-forced-newline"/>BOUNDARY_STAGE<span> </span><br class="atl-forced-newline"/>BOUNDARY_FLOW<span> </span><br class="atl-forced-newline"/>SOURCE_FLOW<span> </span><br class="atl-forced-newline"/>SOURCE_FLOW_RESERVOIR</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>INITIAL_CONDITION</p></td><td style="text-align: left;" class="confluenceTd"><p>CHANNEL_IC<span> </span><br class="atl-forced-newline"/>RESERVOIR_IC<span> </span></p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>OPERATION</p></td><td style="text-align: left;" class="confluenceTd"><p>OPERATING_RULE<span> </span><br class="atl-forced-newline"/><br class="atl-forced-newline"/>OPRULE_EXPRESSION<span> </span><br class="atl-forced-newline"/>OPRULE_TIME_SERIES</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>OUTPUT_TIME_SERIES</p></td><td style="text-align: left;" class="confluenceTd"><p>OUTPUT_CHANNEL<span> </span><br class="atl-forced-newline"/>OUTPUT_RESERVOIR<span> </span><br class="atl-forced-newline"/>OUTPUT_CHANNEL_SOURCE_TRACK<span> </span><br class="atl-forced-newline"/>OUTPUT_RESERVOIR_SOURCE_TRACK<span> </span><br class="atl-forced-newline"/>OUTPUT_GATE</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>PARTICLE</p></td><td style="text-align: left;" class="confluenceTd"><p>PARTICLE_INSERTION<span> </span><br class="atl-forced-newline"/>PARTICLE_FLUX_OUTPUT<span> </span><br class="atl-forced-newline"/>PARTICLE_GROUP_OUTPUT</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>QUAL_SPATIAL</p></td><td style="text-align: left;" class="confluenceTd"><p>RATE_COEFFICIENT</p></td></tr><tr><td style="text-align: left;" class="confluenceTd"><p>QUAL_TIME_SERIES</p></td><td style="text-align: left;" class="confluenceTd"><p>INPUT_CLIMATE<span> </span><br class="atl-forced-newline"/>NODE_CONCENTRATION<span> </span><br class="atl-forced-newline"/>RESERVOIR_CONCENTRATION</p></td></tr></tbody></table></div>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228767/87228766.png">worddavfc12b6cdb26e67dfc2a101ee2af340bd.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228767/87228768.png">worddavf9e3aa73957a24bdb115e43494948841.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228767/87228769.png">worddave8e1df4e853bb46c4ee6f68afece040d.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228767/87228770.png">worddavd56eb5f63f4c9181cb2a8632c8c6c562.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
