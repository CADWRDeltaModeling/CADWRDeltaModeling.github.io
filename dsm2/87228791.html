<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : DSM2 Bay-Delta Tutorial 7: Clifton Court Diurnal Pumping</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_87228717.html">Tutorials</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : DSM2 Bay-Delta Tutorial 7: Clifton Court Diurnal Pumping
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-Purpose:ThegoalofthistutorialistolearnhowtoimplementadiurnalpumpingquotaforBankspumping(StateWaterProject).IntheprocessyouwilllearnhowtotracktotalsusingtheACCUMULATEfunction.">Purpose: <strong><em>The goal of this tutorial is to learn how to implement a diurnal pumping quota for Banks pumping (State Water Project). In the process you will learn how to</em></strong> <strong><em>track totals using the ACCUMULATE function.</em></strong></h2><h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-Background:TheBankspumpingfacilityisoftenoperatedonadiurnalschedule,emphasizingpumpingduringoff-peakelectricityhours.Anexampleofsummerelectricitypricesfortheyear2005isshowninFigure1:">Background: <strong><em>The Banks pumping facility is often operated on a diurnal schedule, emphasizing pumping during off-peak electricity hours. An example of summer electricity prices for the year 2005 is shown in Figure</em></strong> <strong><em>1:</em></strong></h2><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="371" width="646" src="attachments/87228791/87228792.png" data-image-src="attachments/87228791/87228792.png" data-unresolved-comment-count="0" data-linked-resource-id="87228792" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddav1716141bfb59d0a475a7b5d067b70f84.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228791" data-linked-resource-container-version="1"></span><br/><span class="confluence-anchor-link" id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-_Ref240353786"></span><strong>Figure 1: Example wholesale electricity prices in July 2005 (CWEMF, KT Shum)</strong></p><h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-Anidealizedschedulefromthepointofviewofelectricitywouldbetopumpthemaximumpossibleamountlateatnightuntilthedailypumpingneedsaresatisfied.ActualhourlyvariationsinpumpingareshowninFigure2.Numerousotherfactors("><strong><em>An idealized schedule from the point of view of electricity would be to pump the maximum possible amount late at night until the daily pumping needs are satisfied. Actual hourly variations in pumping are shown in</em></strong> <strong><em>Figure 2.</em></strong> <strong><em>Numerous other factors (e.g. ensuring minimum stage requirements in the Forebay) can affect instantaneous maximum pumping, which is why we might consider an operating rule instead of a simple time series to model diurnal pumping.</em></strong></h2><p><br class="atl-forced-newline"/>In this tutorial we will emulate the ideal pumping schedule by tracking the amount pumped since midnight and quitting once we have pumped a total that satisfies the daily average requested by CALSIM. We will use the ACCUMULATE function to track the total. In a later step we will attenuate pumping to avoid drawing Clifton Court Forebay below -2ft NGVD. <br class="atl-forced-newline"/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="428" width="624" src="attachments/87228791/87228790.png" data-image-src="attachments/87228791/87228790.png" data-unresolved-comment-count="0" data-linked-resource-id="87228790" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf97850b4a4a68ee61b2712f2069b4eb3.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228791" data-linked-resource-container-version="1"></span><br/><span class="confluence-anchor-link" id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-_Ref240355217"></span><strong>Figure 2: Diurnal Variation in Pumping, July-August 2004 (CWEMF, KT Shum)</strong></p><h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-Theplanningstudywewilluseforthistutorialisocap_sdipprovidedinthestudy_templatesdirectory.Thechoicebetweentemporaryandpermanentbarriersisnotcentraltothematerial,thoughtheSDIPprojectdidproposehigherpumping."><strong><em>The planning study</em></strong> <strong><em>we will use</em></strong> <strong><em>for this tutorial is</em> ocap_sdip <em>provided in the study_templates directory.</em></strong> <strong><em>The choice between temporary and permanent barriers is not central to the material, though the SDIP project did propose higher pumping.</em></strong></h2><h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-Preparation">Preparation</h2><p>We will begin by creating a study space to house the planning study.</p><ol><li><strong>Copy the study template:</strong><ol><li>In windows, navigate to <em>\\{DSM2_home}\study_templates.</em> Copy and rename the <em>ocap_sdip</em> template to <em>\\{DSM2_home}\tutorial\ocap_sdip_diurnal_swp</em>.</li><li>If you have not already done so for a previous tutorial, copy the file <em>ocap_2005A01A_EWA2_71_novamp_DV.dss</em> (CALSIM output file used for planning runs) from <em>\\{DSM2_home}\timeseries</em> to <em>\\{DSM2_home}\tutorial\data\calsim.</em> Note that we just put this file in timeseries as a sample – in practice CalSim output will be exterior to the DSM2 distribution (or should go in the study folder).</li></ol></li></ol><p><br/></p><ol><li><strong>Preprocess for sdip barriers:</strong><ol><li>Rename <em>config_sdip_ocap.inp</em> to <em>config_sdip_ocap_diurnal_ccfb.inp</em> and open the file.</li><li>Make sure that the run dates are set to the full 1974-1991 (01OCT1974 0000 – 01OCT1991 0000) sixteen year planning period. It is a good idea to preprocess the full period even if you want to run a subset of these dates.</li><li>Set the DSM2MODIFIER to <em>diurnal_pumping</em>.</li><li>Make sure that the DICU version in the configuration file is 2005, representing a future (2005) level of development.</li><li>Makes sure the STAGE_VERSION in the configuration file is PLANNING-2-SL.</li><li>Make sure the configuration file is pointing to the right directory, file and DSS path to find the CalSim results. In this case, set:<ol><li>CALSIMNAME to ocap_2005A01A_EWA2_71_novamp_DV (CalSim output file without the &quot;.dss&quot; extension)</li><li>CALSIMSTUDY_ORIGINAL to 2005A01A</li><li>CALSIMDIR to ../data/calsim</li></ol></li><li>Save your data</li><li>Launch the preprocessing system. Obtain a command prompt and type:</li></ol></li></ol><p>&gt; prepro config_sdip_ocap_diurnal_ccfb.inp</p><ol><li><strong>Add output for Clifton Court Forebay:</strong><ol><li>In hydro.inp, add output that will allow you to more directly track the operations. Create an OUTPUT_RESERVOIR table. Create a 15min instantaneous output request with <em>clfct</em> or c<em>lifton_court</em> as the name, <em>clifton_court</em> as the reservoir, <em>none</em> as the connecting node and <em>flow-source</em> as the variable. The <em>flow-source</em> output will give the total source and sink inflow to Clifton Court – it will differ from SWP pumping only by a small amount (due to Byron-Bethany Irrigation District).</li></ol></li></ol><p><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/></p><ol><li><strong>Run DSM2:</strong><ol><li>In the configuration file, set the dates 01JAN1975 to 25JAN1975 so that the run will take a short time. These dates will generate the features we want for the tutorial, including a period of low stage at Clifton Court Forebay under diurnal operation. Note that we always preprocess the full period even when we shorten the run.</li><li>Open <em>hydro.inp</em> file and change the included configuration file to config_sdip_ocap_diurnal_ccfb.inp and save it.</li><li>Run the sdip simulation for HYDRO by typing:</li></ol></li></ol><p>&gt; hydro hydro.inp</p><ol><li><strong>Examine the output:</strong></li></ol><p>Once you have run HYDRO, open the file and look at the flow-source output for Clifton Court. This variable represents exports out of Clifton Court Forebay, which are dominated by State Water Project pumping..</p><h2 id="DSM2BayDeltaTutorial7:CliftonCourtDiurnalPumping-DiurnalOperatingRule">Diurnal Operating Rule</h2><p><br class="atl-forced-newline"/><strong>1.</strong> <strong>Create the diurnal rule with no Forebay stage protection:</strong></p><ol><li><ol><li>Create a file called <em>oprule_diurnal_swp.inp</em>. Create empty OPERATING_RULE and OPRULE_EXPRESSION tables. Alternatively, do this by copying, renaming and clearing the contents of another operating rule input file.</li><li>Create an expression to accumulate daily State Water Project (SWP) pumping since midnight:<ol><li>Name: daily_total_swp</li><li>Definition: &quot;ACCUMULATE(ext_flow(name=swp)*DT,0.0,HOUR==0)&quot;</li></ol></li></ol></li></ol><p>This reads &quot;accumulate swp, starting at zero, resetting when the hour of the day is zero&quot;. We multiply by DT to get a volume (which makes the rule time step independent and allows comparison to a daily target). The time series reference comes from elsewhere in the input and is the daily average pumping rate. It is perfectly acceptable to use time series that are defined elsewhere in the DSM2 input without redefining it in the OPRULE_TIME_SERIES table – the latter is just there to allow you to define any <span style="text-decoration: underline;">additional</span> time series you might need.</p><ol><li><ol><li>Create an expression to quantify the da.ily target. Note that we are multiplying an average daily flow in cubic feet per second by the number of seconds in the day to obtain a volume.<ol><li>Name: daily_target_swp</li><li>Definition: ts(name=swp)*(60*60*24)</li></ol></li><li>Create an expression that defines maximum physical SWP pumping as a magnitude:<ol><li>Name: max_swp_pumping</li><li>Definition: 9000.0</li></ol></li><li>Now, in the OPERATING_RULE table create a rule that pumps the maximum until the daily total is reached:<ol><li>Name: swp_diurnal</li><li>Action: &quot;SET ext_flow(name=swp) TO IFELSE(abs(daily_total_swp) &gt; abs(daily_target_swp), 0.0, -max_swp_pumping)&quot;. Note the quotes and the minus sign: SWP is really a sink, not a source.</li><li>Trigger: Use STARTUP or TRUE for the trigger (the two do the same thing, and trigger exactly once at the beginning of the run). The rule will be in use unless it is displaced by another operating rule.</li></ol></li><li>In hydro.inp, add the new <em>oprule_diurnal_swp.inp</em> file at the bottom of the OPERATIONS include block..</li><li>Run HYDRO on the simulation. Examine the output for HYDRO, including Clifton Court reservoir water levels, flow through the gates to node 72 and the &quot;flow-source&quot; output for the reservoir (which will differ from SWP pumping by a small amount due to Byron-Bethany Irrigation District). Are you getting the fully-on-fully-off pumping pattern you expect? Could the same schedule be prepared off-line in advance using a 15-min time series for SWP pumping? Does Clifton Court water surface go below the &quot;warning&quot; level of -2.0ft NGVD needed to maintain flow in the fish facilities?</li><li>Now create an expression identifying a low stage condition:<ol><li>Name: ccfb_stage_low</li><li>Definition: res_stage(res=clifton_court) &lt; -2.0</li></ol></li><li>Change the trigger for swp_diurnal to &quot;NOT ccfb_stage_low&quot;, including the quotes.</li><li>Create an expression that describes inflow into Clifton Court from the outside channel:<ol><li>Name: ccfb_inflow</li><li>Definition: res_flow(res=clifton_court,node=72)</li></ol></li><li>Create a new operating rule that covers the critical case:<ol><li>Name: swp_low_stage</li><li>Action:</li></ol></li></ol></li></ol><p>&quot;SET ext_flow(name=swp) TO <br/>-min2(abs(ccfb_inflow),max_swp_pumping)&quot;<br/>This rule sets exports equal to the inflow to Clifton Court, which allows some pumping to continue as long as it does not further draw down Clifton Court. A simple alternative would be just to set exports to zero.</p><ol><li><ol><li><ol><li>Trigger: ccfb_stage_low</li></ol></li></ol></li></ol><p>Note the minus sign, again because SWP exports are a sink rather than a source. The absolute sign is there to make sure the minimum function is not operating on any big transient negative flows.</p><ol><li><ol><li>Rerun HYDRO. Are you getting the results you expected? Does Clifton Court stage go below -2.0? Are you still pumping according to the expected pattern? Could you implement this policy with a time series controlling SWP instead of an operating rule?</li></ol></li></ol><p><br class="atl-forced-newline"/><br class="atl-forced-newline"/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228791/87228790.png">worddavf97850b4a4a68ee61b2712f2069b4eb3.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228791/87228792.png">worddav1716141bfb59d0a475a7b5d067b70f84.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
