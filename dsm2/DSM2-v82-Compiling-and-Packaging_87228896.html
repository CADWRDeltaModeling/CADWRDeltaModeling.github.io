<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : DSM2 v82 Compiling and Packaging</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Developer-and-Build_87228890.html">Developer and Build</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : DSM2 v82 Compiling and Packaging
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p>This memo presents step-by-step instruction on compiling and packaging DSM2 version 8 assuming a minor (bug-fix) release. </p><h1 id="DSM2v82CompilingandPackaging-Version"><strong>Version</strong></h1><p>The latest DSM2 release version is 8.2.0. The first two digits of DSM2 official version; the 3<sup>rd</sup> digit is used for minor (bug-fix) releases.</p><p>git commit number is also embedded for developer's record, and could be used to check thru '-version' command.</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228900.png" data-image-src="attachments/87228896/87228900.png" data-unresolved-comment-count="0" data-linked-resource-id="87228900" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="vers.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p>The Git number is embedded automatically at compilation time. The following 3 files contains relevant version info:<br/> \dsm2\src\common\version_generate.py<br/> \dsm2_distribute\dsm2\install\copy_hydro_qual_ptmDLL_notepad_style.bat<br/> \dsm2_distribute\dsm2\install\DSM2setup_Script_Generate.py</p><p>*BDO is using an 'unstable trunk' branching strategy in GIT for DSM2 development.<br/>*GIT categories: master is for major development and bug fix; branches are usually for separate and time-consuming studies on old versions; Tags are the records for all release versions.<br/>*DSM2 version tag (the 3<sup>rd</sup> digit in the version number) is designed to use odd number for internal use, and even number for formal release </p><p><br/></p><h1 id="DSM2v82CompilingandPackaging-Checkout"><strong>Checkout</strong></h1><p>Checkout DSM2 from github: <strong><a href="https://github.com/CADWRDeltaModeling/dsm2.git" class="external-link" rel="nofollow">https://github.com/CADWRDeltaModeling/dsm2.git</a></strong></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228903.png" data-image-src="attachments/87228896/87228903.png" data-unresolved-comment-count="0" data-linked-resource-id="87228903" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="github.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p>place the project in local directory, e.g. D:\dev\dsm2_master\</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228905.png" data-image-src="attachments/87228896/87228905.png" data-unresolved-comment-count="0" data-linked-resource-id="87228905" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="local0.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><br/></p><p class="auto-cursor-target">Check out could be conduct at command line</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>git clone https://github.com/CADWRDeltaModeling/dsm2.git</pre>
</div></div><p class="auto-cursor-target">Or use software sourceTree (recommended for later use). Note which branch you're checking out (master by default).</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228904.png" data-image-src="attachments/87228896/87228904.png" data-unresolved-comment-count="0" data-linked-resource-id="87228904" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="srctree0.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><br/></p><p><br/></p><h1 id="DSM2v82CompilingandPackaging-Compile"><strong>Compile</strong></h1><p>Cmake is currently used to control and adapt project compilation (see details at <a href="CMake-Build_87228956.html"><span style="color: rgb(0,102,204);">CMake Build</span></a>).</p><p>From command line, run cmake batch at the project root path. It calls cmake build of oprule, input_storage, then DSM2 sequentially.</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>build_all.bat</pre>
</div></div><p class="auto-cursor-target">The building results are exe of hydro and qual, with dll of ptm, under path \BUILD\Release or Debug</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228902.png" data-image-src="attachments/87228896/87228902.png" data-unresolved-comment-count="0" data-linked-resource-id="87228902" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="local1.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p>The major part of PTM module is written in Java programming language and placed in the source code folder: \dsm2_v8_1\src\ptm. It could be build in two ways:</p><ul><li>ANT: the default compiling procedure is set in build.xml; open the command window and run 'ant' (build.xml as default running file) at current path. The release version of compiled application file will be automatically placed in the folder: \dsm2_v8_0\src\ptm\lib (ptm.jar)</li><li>Eclipse: <a href="DSM2-v82-PTM-Compiling-with-Eclipse_87228921.html">DSM2 v82 PTM Compiling with Eclipse</a></li></ul><p><br/></p><p><br/></p><p><br/></p><p><br/></p><h1 id="DSM2v82CompilingandPackaging-Libraries"><strong>Libraries</strong></h1><p>All the libraries DSM2 needs are precompiled and placed in the folder lib: input storage, oprule, and third parties</p><p>If compiling is required, refer their compile details at <a href="CMake-Build_87228956.html"><span style="color: rgb(0,102,204);">CMake Build</span></a>.<br/><br/><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228901.png" data-image-src="attachments/87228896/87228901.png" data-unresolved-comment-count="0" data-linked-resource-id="87228901" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="lib.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><br/></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Since third_party folder is very big and not easy to copy around, one way to share the same package (w/o increase disk occupance) is to use Windows mklink</p><p>Use admin right to open a command window and type in:</p><p>mklink /D {target location}\third_party {original location}\third_party</p><p>For internal users use this command</p><p>mklink /D third_party \\cnrastore-bdo\Delta_Mod\Share\DSM2\compile_support\third_party</p></div></div><p><br/></p><p><br/></p><h1 id="DSM2v82CompilingandPackaging-Debug"><strong>Debug</strong></h1><p>Cmake also built up the project Visual Studio solution, which could be used do the code debug.</p><p>See the following example for debug setting in Visual Studio 2015.</p><p><br/></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228898.png" data-image-src="attachments/87228896/87228898.png" data-unresolved-comment-count="0" data-linked-resource-id="87228898" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="debug1.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228899.png" data-image-src="attachments/87228896/87228899.png" data-unresolved-comment-count="0" data-linked-resource-id="87228899" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="debug.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p>Make sure the 'debug info' is on the project you're working on (the current VS set it as off by default).</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228895.png" data-image-src="attachments/87228896/87228895.png" data-unresolved-comment-count="0" data-linked-resource-id="87228895" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="debug_on.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><br/></p><h1 id="DSM2v82CompilingandPackaging-Packaging"><strong>Packaging</strong></h1><p>Download from share folder and change folder name to dsm2_distribute\</p><p>under branch (e.g. master), aside with dsm2</p><p><span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228897.png" data-image-src="attachments/87228896/87228897.png" data-unresolved-comment-count="0" data-linked-resource-id="87228897" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="package1.PNG" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span></p><p><br/></p><p>1. Generate tutorial PDF files:</p><p>a) Delete all PDF files in &quot;dsm2_distribute\dsm2\tutorials\pdf&quot;</p><p>b) Run &quot;doc2pdf.vbs&quot; in &quot;\dsm2_distribute\dsm2\install\&quot; to generate PDFs from tutorial word documents.</p><p><br/></p><p>2. Copy compiled binaries to distribution folder:</p><p>a) Check the DSM2 version and paths to the compiled binaries are correct in the batch file &quot;copy_hydro_qual_ptmDLL_notepad_style.bat&quot; in the folder \dsm2_distribute\dsm2\install\</p><p>Be aware of the version consistence for the 3 control files mentioned in 'DSM2 Versioning'; if not, correct them and re-compile from 6-4 in the previous section</p><p>b) Run the batch file &quot;copy_hydro_qual_ptmDLL_notepad_style.bat&quot;.</p><p><br class="atl-forced-newline"/> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228908.png" data-image-src="attachments/87228896/87228908.png" data-unresolved-comment-count="0" data-linked-resource-id="87228908" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-6-13_15-47-35.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span><br/> <br/>Manually copy hydro.exe, qual.exe, ptm.dll, ptm.jar to the folder<br/> \dsm2_distribute\dsm2\bin</p><p><br/></p><p>3. Generate packaging script:</p><p>a) Check the DSM2 version is correct in the Python script &quot;DSM2setup_Script_Generate.py&quot; in the folder \dsm2_distribute\dsm2\install\</p><p>Be aware of the version consistence for the 3 control files mentioned in 'DSM2 Versioning'; if not, correct them and re-compile from 6-4 in the previous section</p><p>b) Run this Python script to generate Inno Setup script &quot;DSM2setup_v8.iss&quot;.</p><p><br/></p><p>4. Create DSM2 installation file:</p><p> Run &quot;DSM2setup_v8.iss&quot; with Inno Setup Compiler v5.2.3<br/>The installation file named &quot;DSM2setup_8.X.Xrelease.XXXX.exe&quot; will be created in the same folder, \dsm2_distribute\dsm2\install\<br/> <span class="confluence-embedded-file-wrapper"><img class="confluence-embedded-image" src="attachments/87228896/87228906.png" data-image-src="attachments/87228896/87228906.png" data-unresolved-comment-count="0" data-linked-resource-id="87228906" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="image2017-6-13_15-47-59.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span><br/> </p><p><br/></p><p>5. Quick-test installer:</p><p>Test installation on a clean machine. Run historical hydro, qual_ec and ptm on study templates.</p><p><br/></p><p>6. Tag and version increment:</p><p>Create release tag for both &quot;dsm2&quot; source code on github and &quot;dsm2_distribute&quot; folders on share-folder. </p><p><br class="atl-forced-newline"/> <br class="atl-forced-newline"/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="487" width="631" src="attachments/87228896/87228911.png" data-image-src="attachments/87228896/87228911.png" data-unresolved-comment-count="0" data-linked-resource-id="87228911" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddav07c1c902559a15d9cb8d941d966322cb.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228896" data-linked-resource-container-version="1"></span><br/> </p><p>For future usage, immediately increment DSM2 version number (3rd digit to the next odd number) in the following three files:</p><ul><li>\dsm2\src\common\version_generate.py  </li><li>\dsm2_distribute\dsm2\install\copy_hydro_qual_ptmDLL_notepad_style.bat  </li><li>\dsm2_distribute\dsm2\install\DSM2setup_Script_Generate.py</li></ul><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228895.png">debug_on.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228897.png">package1.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228898.png">debug1.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228899.png">debug.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228900.png">vers.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228901.png">lib.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228902.png">local1.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228903.png">github.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228904.png">srctree0.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228905.png">local0.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228906.png">image2017-6-13_15-47-59.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228907.png">image2017-6-13_15-47-43.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228908.png">image2017-6-13_15-47-35.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228909.png">image2017-6-13_15-47-17.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228910.png">image2017-6-13_15-46-58.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228911.png">worddav07c1c902559a15d9cb8d941d966322cb.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228912.png">worddavb0ec1d6cc7478dc4ec73bc27abb42880.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228913.png">worddav0037c3b8067a8dd0d52094029690277b.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228914.png">worddav490ef33751ab42acaa896e9bb7dc2dc7.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228915.png">worddav73b529f2e3382f4bb77f505185a10945.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228916.png">worddavc7e39738a4a8caa213b31d248d81f87b.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228917.png">worddavb58034debe15b3d2514f722580c782ad.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228918.png">worddav1c1324ef8177e0822bb62d9cdf8fdb05.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228896/87228919.png">worddava9503121f9ac50fd0060de1b95c6decc.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
