<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : Tutorial 5: Advanced Output and Source Tracking</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_87228717.html">Tutorials</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : Tutorial 5: Advanced Output and Source Tracking
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><strong>Task</strong></p><ul><li>Create boundary and source groups</li><li>Request output for constituent source tracking</li></ul><p><br class="atl-forced-newline"/><strong>Skills Gained</strong> <br/>Learn how to use advanced output options in DSM2 including source tracking</p><p><br class="atl-forced-newline"/><br class="atl-forced-newline"/>The purpose of this tutorial is to provide instruction on advanced output options in DSM2. Basic outputs include flow, stage and constituent concentrations at nodes and channel locations. Advanced outputs include creating output groups and source tracking.<br/>The first part of this tutorial involves modifications to the text input file, <em>hydro.inp</em>. We will add some outputs and also take a look at how data in <em>hydro.inp</em> is prioritized. The second part introduces the use of <em>groups</em> for source tracking. This tutorial uses the simple channel network shown in Figure 1. <br/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="385" width="623" src="attachments/87228777/87228779.png" data-image-src="attachments/87228777/87228779.png" data-unresolved-comment-count="0" data-linked-resource-id="87228779" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavd56eb5f63f4c9181cb2a8632c8c6c562.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span><strong>dummy_res</strong> <br class="atl-forced-newline"/><span class="confluence-anchor-link" id="Tutorial5:AdvancedOutputandSourceTracking-_Ref238894332"></span><strong>Figure 1:</strong> <strong>Simple channel with a reservoir, gate, flow transfer and dummy reservoir.</strong> <br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/></p><ol><li><strong>Add Output Paths to <em>hydro.inp</em>:</strong></li></ol><p>In this step of the tutorial, we will request output upstream and downstream of the gate and reservoir 1.</p><ol><li><ol><li>In Windows Explorer, navigate to the directory, <em>\\{DSM2_home}\tutorial\simple\t5_output</em>.</li><li>Open the file <em>addin.inp</em> and note the new output paths for the channels and reservoir.</li><li>Copy the entire file contents to the clipboard.</li><li>Open the file <em>hydro.inp</em>.</li><li>Navigate to the bottom of the file and paste the information. Note that there are now two output requests for a location named bnd_1. In <em>hydro.inp</em> bnd_1 is defined as channel1 location 0 and in <em>output_hydro_tutorial.inp</em> it has been defined as channel 1 location 100.</li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228777/87228778.png" data-image-src="attachments/87228777/87228778.png" data-unresolved-comment-count="0" data-linked-resource-id="87228778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf9e3aa73957a24bdb115e43494948841.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span> For flow data at bnd_1, will the output be written at the upstream end of the channel (location 0) or 100ft downstream? <br/><strong>Answer:</strong> The output will be for 100ft downstream because the output request in the launch file (e.g. <em>hydro.inp</em> or <em>qual.inp</em>) supersedes all other output requests that have the same identifier. In this case the identifier is the NAME and VARIABLE combination (e.g. bnd_1 and flow). <br class="atl-forced-newline"/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228777/87228778.png" data-image-src="attachments/87228777/87228778.png" data-unresolved-comment-count="0" data-linked-resource-id="87228778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf9e3aa73957a24bdb115e43494948841.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span> How would you get output at channel 1 and both location 0 and location 100? <br/><strong>Answer:</strong> Give each location a unique identifier, eg. bnd_1 and bnd_100.</p><p><br class="atl-forced-newline"/><br class="atl-forced-newline"/></p><ol><li><strong>Add <em>Boundary</em> and <em>Source Groups</em>:</strong></li></ol><p>GROUPS are user-defined groups of model objects, for instance groups of water bodies or groups of boundary inputs. Groups are used a number of places in DSM2, including: tracking of constituents originated from grouped sources, tracking of particles as they reside or move between groups of water bodies and/or boundaries, and assignment of rate coefficients in QUAL to groups of water bodies. In the output specifications, groups are used to define aggregate sources for source tracking. For example, output groups could be used to track mass originating from all the boundaries, or from all Delta Island Consumptive Use (DICU) diversions, etc. In this section, we will create two output groups: boundary locations and water quality constituent source locations.</p><ol><li><ol><li>In the study directory, create a file called <em>group_tutorial.inp</em>.</li><li>In the <em>group_tutorial.inp</em> file, add a group table. Note that this is a parent table for overwriting/layering purposes. Define a boundary and a sources group:</li></ol></li></ol><p>GROUP<br/>NAME <br/>boundary <br/>sources <br/>END</p><ol><li><ol><li>Now define the group members. Create the GROUP_MEMBER table below the GROUP table:</li></ol></li></ol><p>GROUP_MEMBER<br/>GROUP_NAME MEMBER_TYPE PATTERN <br/>END</p><ol><li><ol><li>In the <em>Group Members</em> <em>table</em>:<ol><li>Enter a row with the following values in the appropriate fields:<ol><li>GROUP_NAME: <em>boundary</em></li><li>MEMBER_TYPE: <em>stage</em></li><li>PATTERN: <em>.<strong>stream.</strong></em></li><li>Note that the dot-star .* in the above pattern is a &quot;regular expression&quot; wildcard. You can use any standard Perl-style regular expression in groups, but the html documentation for GROUPS describes most of the patterns you can put in a GROUP_MEMBER that are really useful.</li></ol></li></ol></li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228777/87228778.png" data-image-src="attachments/87228777/87228778.png" data-unresolved-comment-count="0" data-linked-resource-id="87228778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf9e3aa73957a24bdb115e43494948841.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span> Look in the <em>input_boundary_hydro_tutorial.inp</em> file and determine what boundary conditions are part of the boundary group based on the member type &quot;stage&quot; and the pattern &quot;.<strong>stream.</strong>&quot;. </p><ol><li><ol><li><ol><li>Enter another row with the following values in the appropriate fields:<ol><li>GROUP_NAME: <em>boundary</em></li><li>MEMBER_TYPE: <em>flow_boundary</em></li><li>PATTERN: <em>.<strong>stream.</strong></em></li></ol></li></ol></li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228777/87228778.png" data-image-src="attachments/87228777/87228778.png" data-unresolved-comment-count="0" data-linked-resource-id="87228778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf9e3aa73957a24bdb115e43494948841.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span> Look in the <em>input_boundary_hydro_tutorial.inp</em> file and determine what boundary conditions are part of the boundary group based on the member type &quot;flow_boundary&quot; and the pattern &quot;.<strong>stream.</strong>&quot;. </p><ol><li><ol><li><ol><li>In the <em>Group Members</em> <em>table</em> insert another row with the following values in the appropriate fields:<ol><li>GROUP_NAME: <em>sources</em></li><li>MEMBER_TYPE: <em>source_sink</em></li><li>PATTERN: <em>source1</em></li></ol></li></ol></li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228777/87228778.png" data-image-src="attachments/87228777/87228778.png" data-unresolved-comment-count="0" data-linked-resource-id="87228778" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavf9e3aa73957a24bdb115e43494948841.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span> Look in the various qual input files and determine which inputs will make up the sources group defined above. </p><ol><li><ol><li>In the <em>qual.inp</em> file, create the GROUPS (note the plural) include block that will reference this file:</li></ol></li></ol><p>GROUPS<br/>group_tutorial.inp<br/>END</p><ol><li><ol><li>Save the current settings.</li></ol></li></ol><p><br/></p><ol><li><strong>Source Tracking:</strong></li></ol><p>Source tracking (aka fingerprinting) determines the amount of water or of a constituent at one location that originated from a specified location. For constituent fingerprinting, 1) define a source group (e.g. boundaries or DICU locations), and then 2) request output for that group. For volumetric fingerprinting that indicates the percentage of flow that originated from each boundary location, 1) create a fingerprinting constituent and set its value equal to 100 at all boundaries, 2) define a source group for all boundaries, and 3) request output from that source group. <br class="atl-forced-newline"/><br class="atl-forced-newline"/></p><ol><li><strong>Add Source Tracking Output for <em>Channel 5</em>:</strong></li></ol><p>To demonstrate source tracking, this part of the tutorial examines how much of the EC in channel 5 (see Figure 1) came from the boundaries and from other sources. For comparison purposes, the EC from all sources will also be output.<br/>Create a new file called output_qual_sourcetrack.inp.</p><ol><li><ol><li>In this file, create an OUTPUT_CHANNEL_SOURCE_TRACK table. Refer to the documentation to create the header.</li><li>In the <em>Channel Output</em> table create 3 rows:<ol><li>For the first new row, enter the following values into the appropriate fields:<ol><li>Name: <em>ch5</em></li><li>Channel: <em>5</em></li><li>Distance: <em>5000</em></li><li>Variable: <em>ec</em></li><li>Source Group: <em>all</em> (this will track ec from all sources)</li><li>Output File: <em>${QUALOUTDSSFILE}</em></li><li>Time Interval: <em>15min</em></li><li>Period Op: <em>inst</em></li></ol></li><li>For the second new row, enter the following values into the appropriate fields:<ol><li>Name: <em>ch5</em></li><li>Channel: <em>5</em></li><li>Distance: <em>5000</em></li><li>Variable: <em>ec</em></li><li>Source Group: <em>boundary</em></li><li>Output File: <em>${QUALOUTDSSFILE}</em></li><li>Time Interval: <em>15min</em></li><li>Period Op: <em>inst</em></li></ol></li><li>For the third new row, enter the following values into the appropriate fields:<ol><li>Name: <em>ch5</em></li><li>Channel: <em>5</em></li><li>Distance: <em>5000</em></li><li>Variable: <em>ec</em></li><li>Source Group: <em>sources</em></li><li>Output File: <em>${QUALOUTDSSFILE}</em></li><li>Time Interval: <em>15min</em></li><li>Period Op: <em>inst</em></li></ol></li></ol></li><li>Save the current settings.</li></ol></li></ol><p><br/></p><ol><li><strong>Running HYDRO and QUAL</strong><ol><li>Open a command window for the <em>t5_output</em> directory.</li><li>In the command window, type: <em>hydro hydro.inp</em>.</li><li>In the command window, type: <em>qual qual.inp</em>.</li><li>Open the hydro echo file output_tutorial_hydro_echo.inp. Which version of bnd_1 got picked up by the model, the one in hydro.inp or the one in output_hydro_tutorial.inp.</li><li>Open the <em>output.dss</em> file in the <em>t5_output</em> directory, and examine the results. Do a mass balance to make sure the source tracking adds up.</li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="96" width="82" src="attachments/87228777/87228776.png" data-image-src="attachments/87228777/87228776.png" data-unresolved-comment-count="0" data-linked-resource-id="87228776" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavfc12b6cdb26e67dfc2a101ee2af340bd.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228777" data-linked-resource-container-version="1"></span></p><ol><li><strong>Brain Teaser</strong></li></ol><p>How would you set up a source tracking simulation to determine what percentage of water/flow at a given location originated from a specified boundary?</p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228777/87228776.png">worddavfc12b6cdb26e67dfc2a101ee2af340bd.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228777/87228778.png">worddavf9e3aa73957a24bdb115e43494948841.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228777/87228779.png">worddavd56eb5f63f4c9181cb2a8632c8c6c562.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
