<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : Tutorial 6: Operating Rules</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_87228717.html">Tutorials</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : Tutorial 6: Operating Rules
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span>, last modified on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <p><strong>Task</strong></p><ul><li>Operate a gate based on stage criteria</li><li>Regulate a source/sink inflow</li></ul><p><br class="atl-forced-newline"/><strong>Skills Gained</strong> Get an introduction to operating rules</p><p><br class="atl-forced-newline"/>The purpose of this tutorial is to practice using Operating Rule Language (ORL) statements to set gate operations and flows. With operating rules, expressions can be crafted to steer the model on-the-fly; e.g., a gate can be directed to automatically close when stage conditions reach a certain threshold. In this tutorial we will create operating rules to operate a gate and to regulate a source/sink inflow. <br/><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228781/87228782.png" data-image-src="attachments/87228781/87228782.png" data-unresolved-comment-count="0" data-linked-resource-id="87228782" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddave8e1df4e853bb46c4ee6f68afece040d.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228781" data-linked-resource-container-version="5"></span> Extensive documentation on the DSM2 operating rules can be found at:<br/>START menu <em>Programs</em>  <em>DSM2_v8</em>  <em>DSM2_documentation</em> Operating Rules</p><p>gate_2 <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="347" width="623" src="attachments/87228781/87228780.png" data-image-src="attachments/87228781/87228780.png" data-unresolved-comment-count="0" data-linked-resource-id="87228780" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddavd56eb5f63f4c9181cb2a8632c8c6c562.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228781" data-linked-resource-container-version="5"></span><strong>dummy_res</strong><br/><span class="confluence-anchor-link" id="Tutorial6:OperatingRules-_Ref238894332"></span><strong>Figure 1:</strong> <strong>Simple channel with a reservoir, gate, flow transfer and dummy reservoir.</strong></p><ol><li><strong>Adding a Second Gate Where Op Rule Will Be Applied</strong></li></ol><p>In this step of the tutorial we will prepare a new layer and add the gate that will be manipulated by the op rule.</p><ol><li style="list-style-type: none;"><ol><li>In Windows Explorer, navigate to the directory, <em>\\{DSM2_home}\tutorial\simple\t6_oprule</em>.</li><li>Create a file <em>grid_tutorial_opitems.inp</em>.</li><li>Open <em>grid_tutorial_base.inp</em>. We are going to copy items from this file into the new file with minor changes:<ol><li>Copy the GATE table with <em>gate_1,</em> paste it into <em>grid_tutorial_opitems.inp</em> and change the following fields:<ol><li>NAME: <em>gate_2</em></li><li>FROM_OBJ: channel</li><li>FROM_IFENTIFIERS: 5</li><li><p>TO_NODE: 5</p></li></ol></li></ol></li><li>In the <em>Gate_Weir Devices table</em>:<ol><li>Copy the data from gate_1 to <em>grid_tutorial_opitems.inp</em>, change the gate name to gate_2 and change the following fields:</li><ol><li>GATE_NAME: Gate_1</li><li>Elev: <em>-2</em></li></ol></ol></li><li>Save the current settings.</li><li>Add <em>grid_tutorial_opitems.inp</em> to the list of included files in <em>hydro.inp.</em></li></ol></li></ol><p><br/></p><ol><li><strong>Adding Output for the Second Gate:</strong><ol><li>Create a file called <em>output_oprule_tutorial.inp</em>.</li><li>Create the OUTPUT_GATE table:</li></ol></li></ol><p>OUTPUT_GATE<br/>NAME GATE_NAME DEVICE VARIABLE INTERVAL PERIOD_OP FILE<br/>END</p><ol><li style="list-style-type: none;"><ol><li>In the output table enter the following values into the appropriate fields:<ol><li style="list-style-type: none;"><ol><li>Output Name: <em>gate_2_weirop</em></li><li>Gate name: <em>gate_2</em></li><li>Device: <em>weir</em></li><li>Variable: <em>op-from-node</em></li><li>Time Interval: <em>15min</em></li><li>Period Op: <em>inst</em></li><li>File: <em>${HYDROOUTDSSFILE}</em></li></ol></li></ol></li><li>Add the following channel outputs in a new OUTPUT_CHANNEL table:</li></ol></li></ol><p>OUTPUT_CHANNEL<br/>NAME CHAN_NO DISTANCE VARIABLE INTERVAL PERIOD_OP FILE<br/><strong>trigger_loc</strong> <strong>4 7500 stage 15min inst ${HYDROOUTDSSFILE}</strong> <br/><strong>ds_gate2 5 0 flow 15min inst</strong> <strong>${HYDROOUTDSSFILE}</strong><br/>END</p><ol><li style="list-style-type: none;"><ol><li>Add the output layer to the list of include files in <em>hydro.inp</em> and save your work.</li></ol></li></ol><p><br/></p><ol><li><strong>Create an Operating Rule to Close the Weir when Stage is Low:</strong></li></ol><p>Now we are ready to write the first operating rule. This rule closes the new gate we created during times where stage at a monitoring point is low. First we will define the rule in terms of an expression called <em>stage_critical</em> (the condition where stage violates a minimum) and <em>op_applies</em> (a seasonal condition that is True when we are controlling the gate for stage. In a later step we will define these variables.</p><ol><li style="list-style-type: none;"><ol><li>Create a file called <em>oprule_tutorial.inp</em>.</li><li>Create the <em>Operating Rules</em> table:</li></ol></li></ol><p>OPERATING_RULE<br/>NAME ACTION TRIGGER<br/>END</p><ol><li style="list-style-type: none;"><ol><li style="list-style-type: none;"><ol><li>Enter the following values into the appropriate fields:<ol><li>Name: <em>weir_close</em></li><li>Action Definition: &quot;<em>SET gate_op(gate=gate_2, device=weir, direction=from_node) TO CLOSE RAMP 30MIN&quot;</em></li></ol></li></ol></li></ol></li></ol><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="29" width="29" src="attachments/87228781/87228782.png" data-image-src="attachments/87228781/87228782.png" data-unresolved-comment-count="0" data-linked-resource-id="87228782" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="worddave8e1df4e853bb46c4ee6f68afece040d.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228781" data-linked-resource-container-version="5"></span> You must use quotes for inputs with spaces.</p><ol><li style="list-style-type: none;"><ol><li style="list-style-type: none;"><ol><li style="list-style-type: none;"><ol><li>Trigger Definition: &quot;<em>stage_critical AND op_applies&quot;</em></li></ol></li></ol></li><li>Create an OPERATION include block in hydro.inp and add the new file so that it will be used by DSM2-HYDRO.</li></ol></li></ol><p>OPERATION<br/>oprule_tutorial.inp<br/>END</p><ol><li style="list-style-type: none;"><ol><li>Save the current settings.</li></ol></li></ol><p><br class="atl-forced-newline"/>Note that the expressions stage_critical and op_applies will be created in a later step.</p><ol><li><strong>Create an Operating Rule to Open the Weir when Stage is High:</strong></li></ol><p>As before, we will enter the rule to open the weir first in terms of the expressions <em>stage_relax</em> (a condition where stage is safely above a threshold where we can open the gate) and <em>op_applies</em>. In the next step we will define these expressions.</p><ol><li style="list-style-type: none;"><ol><li>In the <em>Operating Rules</em> <em>table</em> enter the following values into the appropriate fields:<ol><li style="list-style-type: none;"><ol><li>Name: <em>weir_open</em></li><li>Action Definition: &quot;<em>SET gate_op(gate=gate_2, device=weir, direction=from_node) TO OPEN RAMP 30MIN&quot;</em></li><li>Trigger Definition: &quot;( stage_relax AND op_applies) OR NOT(op_applies)&quot;</li></ol></li></ol></li><li>Save the current settings.</li><li>In the <em>hydro.inp</em> file, add the following environmental variables and values into the ENVVAR section:</li></ol></li></ol><p>STAGE_CRITICAL 1.4<br/>STAGE_RELAX 1.6</p><ol><li><strong>Define Expressions used in the rule</strong><ol><li>In the file oprule_tutorial.inp, create the OPRULE_EXPRESSION table:</li></ol></li></ol><p>OPRULE_EXPRESSION<br/>NAME DEFINITION<br/>END</p><ol><li style="list-style-type: none;"><ol><li style="list-style-type: none;"><ol><li>Enter the following values into the appropriate fields:<ol><li>Name: <em>op_applies</em></li><li>Definition: &quot;<em>SEASON &lt; 01FEB&quot;</em></li></ol></li><li>Enter the following values into the appropriate fields. Don't forget quotes!!<ol><li>Name: <em>stage_critical</em></li><li>Definition: &quot;<em>chan_stage(channel=4, dist=7500) &lt; ${STAGE_CRITICAL}&quot;</em></li></ol></li><li>Enter the following values into the appropriate fields:<ol><li>Name: <em>stage_relax</em></li><li>Definition: &quot;<em>chan_stage(channel=4, dist=7500) &gt; ${STAGE_RELAX}&quot;</em></li></ol></li></ol></li><li>Save the current settings.</li><li>Now run HYDRO and QUAL:<ol><li>Open a command window for the <em>t6_oprule</em> directory.</li><li>In the command window, type: <em>hydro hydro.inp</em>.</li><li>In the command window, type: <em>qual qual.inp</em>.</li><li>Open the <em>output.dss</em> file in the <em>t6_oprule</em> directory, and examine the results.</li></ol></li></ol></li></ol><p><br/></p><ol><li><strong>Add a Reduced Flow Operating Rule:</strong></li></ol><p>In our next operating rule, we will control the inflow to a node by having it toggle back and forth between a larger &quot;full flow&quot; and a &quot;reduced flow&quot;. First we will enter the rule and then we will define the full and reduced flows.</p><ol><li style="list-style-type: none;"><ol><li>In the <em>Operating Rules table</em> enter the following values into the appropriate fields:<ol><li style="list-style-type: none;"><ol><li>Name: <em>flow_reduce</em></li><li>Action Definiton: <em>SET ext_flow(name=source1) TO ifelse(stage_critical,reduced_flow,full_flow)</em></li><li>Trigger Definition: <em>TRUE</em></li></ol></li></ol></li><li>Now create the expressions that define <em>full_flow</em> and <em>reduced_flow</em>. In the <em>Oprule</em> <em>Expressions</em> table:<ol><li>Enter the following values into the appropriate fields that define <em>full_flow.</em> This will involve the time series <em>source_flow</em> which we will enter later:<ol><li>Input Name: <em>full_flow</em></li><li><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p>Definition: <em>ts(name=source_flow) [note: this is a reference to a time series we haven't defined yet].</em></p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p></li></ol></li><li>Do the same for <em>reduced_flow.</em> Note: we are defining <em>reduced</em><em>flow in terms of the time series. There is no guarantee of what order expressions will be evaluated, so you cannot safely define _reduced_flow</em> in terms of another expression such as <em>full_flow</em>. Enter the following values into the appropriate fields:<ol><li>Input Name: <em>reduced_flow</em></li><li>Definition: <em>0.5*ts(name=source_flow).</em></li></ol></li></ol></li><li>Save the current settings.<ol><li>Now we will define the <em>source_flow</em> time series upon which the <em>full_flow</em> and <em>reduced_flow</em> expressions are based.</li></ol></li><li>Create the <em>Operation Time Series</em> table:</li></ol></li></ol><p>OPRULE_TIME_SERIES<br/>NAME FILLIN FILE PATH</p><ol><li style="list-style-type: none;"><ol><li style="list-style-type: none;"><ol><li>Enter the following values into the appropriate fields:<ol><li>Input Name: <em>source_flow</em></li><li>Input File: <em>${TUTORIALINPUT}</em></li><li><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p>Path: <em>/TUTORIAL/SOURCE/FLOW//15MIN/CONSTANT/    [ Note: there are two forward slashes between FLOW</em> and <em>15MIN]</em></p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p></li><li>Fillin: <em>none</em></li></ol></li></ol></li><li>Save the current settings.</li></ol></li></ol><p><span class="confluence-anchor-link" id="Tutorial6:OperatingRules-OLE_LINK1"></span></p><ol><li><strong>Override the Expression op_applies:</strong></li></ol><p>Recall that <em>op_applies</em> is used to determine when the weir is operated. Previously the definition of this expression was seasonal: the expression was SEASON &lt; 01FEB. The goal now is to make the same expression depend on a time series. Rather than change the expression, we will override it in a new layer.</p><ol><li style="list-style-type: none;"><ol><li>Add a new Operating Rules Layer:<ol><li>Create a file called <em>oprule</em>_ <em>tutorial</em> revision.inp_</li></ol></li><li>Redefine the expressions that define <em>op_applies</em>. In the <em>Expressions</em> table:<ol><li>Create the OPRULE_EXPRESSION table.</li><li>Enter the following values into the appropriate fields:<ol><li>Input Name: <em>op_applies</em></li><li><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><p>Definition: "ts(name=op_used)&gt;0.0" [note: this is a reference to a time series we will define in the next step]._</p></p><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p /><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p><p><br/></p></li></ol></li></ol></li><li>Define the time series <em>op_used</em> on which the <em>op_applies</em> expression depends. In the <em>Operation Time Series</em> table:<ol><li>Right-click and select <em>Insert row</em>.</li><li>Enter the following values into the appropriate fields:<ol><li>Input Name: <em>op_used</em></li><li>Input File: <em>${TUTORIALINPUT}</em></li><li>Path: <em>/TUTORIAL/GATE/FLAP_OP//IR-YEAR/TIMEVAR/</em></li><li>Fillin: <em>none</em></li></ol></li></ol></li><li>Add <em>oprule_tutorial_revision.inp</em> after <em>oprule_tutorial.inp</em> in the OPERATIONS block of hydro.inp so that it will be used by HYDRO.</li><li>Run HYDRO and QUAL and examine the results.</li></ol></li></ol><p><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/><br class="atl-forced-newline"/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228781/87228780.png">worddavd56eb5f63f4c9181cb2a8632c8c6c562.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228781/87228782.png">worddave8e1df4e853bb46c4ee6f68afece040d.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
