<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : Update DSM2 historical simulation</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Documentation_87228546.html">Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="Delta-DSM2-Documentation_87228587.html">Delta DSM2 Documentation</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : Update DSM2 historical simulation
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Lan Liang</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h2 id="UpdateDSM2historicalsimulation-Introduction"><strong>Introduction</strong></h2><p>The historical simulation of Delta Simulation Model II (DSM2) simulates the ground truth of Sacramento-San Joaquin Delta(Delta) hydrodynamics and water quality. It requires collecting the observed flows, stages, and water quality at the model boundaries and the actual gate operations as much as possible, converting them into the data format DSM2 recognizes, and conducting quality assurance and quality control (QA/QC). The missing inputs must be filled to make DSM2 run successfully. This document directs all the procedures of preparing the inputs for DSM2 historical simulation. All the required scripts and information for updating DSM2 historical simulation have been included in the package. The package has been saved in the shared folder <a rel="nofollow">\\nasbdo\Delta_Mod\Share\lanliang\Update_DSM2_package</a>. Some links might not be effective on this page, but work well in the document <u><span style="color: rgb(0,51,102);">Update DSM2 Historical Simulation.docx</span></u><span style="color: rgb(0,51,102);"> in the</span><span style="color: rgb(0,51,102);"> shared folder.</span></p><h2 id="UpdateDSM2historicalsimulation-Prerequisites"><strong>Prerequisites</strong></h2><p><strong><strong>1.     </strong> </strong>Window command prompt: double clicks two files in the folder: <a href="file:///Z:/lliang/cdec_data_retrieve/DSM2_updates/Update_DSM2/window_command" class="external-link" rel="nofollow">Window command</a>. It allows you to open a command window by clicking the current folder in Windows file explorer. Python scripts run in the command window.</p><p><strong><strong>2.     </strong></strong>HEC-DSSVue:  Download and install <a href="http://www.hec.usace.army.mil/software/hec-dssvue/downloads.aspx" class="external-link" rel="nofollow">HEC-DSSVue</a>. It is essential for visualizing and examining data and converting data into the required formats.</p><p><strong>3.     </strong>Vtools: Download and install <a href="http://baydeltaoffice.water.ca.gov/modeling/deltamodeling/models/vtools/install_vtools.html#prerequisites" class="external-link" rel="nofollow">Vtools</a>. It is the tools to process the DSS data. Its functions are called by the python scripts to update DSM2 historical simulation.</p><p><strong><strong>4.  </strong>  </strong>Python: Download and install Python 2.7, the version compatible with Vtools, from the websites of <a href="https://www.python.org/downloads/" class="external-link" rel="nofollow">Python</a> or <a href="https://www.anaconda.com/download/" class="external-link" rel="nofollow">Anaconda</a>.</p><h2 id="UpdateDSM2historicalsimulation-Theschematicofupdatingprocedures"><strong>The schematic of updating procedures</strong></h2><p>The schematic indicates the four major steps for updating the inputs for a DSM2 simulation of historical Delta hydrodynamics and electrical conductivity (EC). Each step consists of collecting part of data and conducting QA/QC. The technical specification of the procedure has been described below. Once the four steps for updating the DSM2 historical simulation are conducted, the latest version of the DSS files (DICU_YYYYMM.dss, histYYYYMM.dss, and gates-v8-YYYYMM.dss) are generated. Copy these three DSS files in the DSM2 subfolder \timeseries and the DSM2 historical simulation update is completed. </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/87228633/87228632.png" data-image-src="attachments/87228633/87228632.png" data-unresolved-comment-count="0" data-linked-resource-id="87228632" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="plots_for_chapters.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228633" data-linked-resource-container-version="1"></span></p><p><br/></p><h2 id="UpdateDSM2historicalsimulation-Step1:DICUUpdate(underthefolder/DICU)"><strong>Step 1: DICU Update (under the folder /DICU)</strong></h2><p><strong>1.      </strong><strong>Retrieve CIMIS data</strong></p><p><strong>-</strong>          Log in <a href="http://wwwcimis.water.ca.gov/Auth/Login.aspx" class="external-link" rel="nofollow">CIMIS</a> with the user name <u>wildej</u> and password <u>delta</u>, and click <u>DATA</u> and then <u>My Reports.</u></p><p><strong>-</strong>          Under the list <u>Quick Reports</u>, click <u>Execute monthly Report</u>, <u>List 1</u>, and then the report is loaded in an Excel spreadsheet. This report includes the precipitation and reference ET and other climatic data at stations Davis(6), Brentwood(47), Manteca(70), Twitchell(140), Lodi West(166), Tracy(167). Right now, the data at Lodi West are missing on that spreadsheet.</p><p><strong>-</strong>         Log off CIMIS and close the browser.</p><p><strong>2.      </strong><strong>Prepare precipitation and evapotranspiration data in DICU-YYYYMM.xlsm</strong></p><p><strong>-</strong>          Delete the second and third columns in the downloaded spreadsheet, and copy the data into<a href="file:///Z:/lliang/cdec_data_retrieve/DSM2_updates/Update_DSM2/DICU/DICU-201712.xlsm" class="external-link" rel="nofollow">DICU-YYYYMM.xlsm</a>  on <u>CIMISData</u> sheet with the same format.</p><p><strong>-</strong>          Check data on PrecipLookupToDSS sheet are correctly linked to the data on CIMISData sheet. Sometimes, the data is not available in some months or some stations on CIMISData. When the downloaded spreadsheet is pasted on the CIMISData sheet, the precipitation and reference ET on CIMISData will be automatically copied to another sheet <u>PrecipLookupToDSS</u>. In order to make the data automatically transfer from CIMISData to PrecipLookupToDSS, the rows of the missing data in CIMISData have to be filled with blanks.</p><p><strong>-</strong>          Extend the data on TimeSeries sheet, and keep the same formulas on each column. The long-term mean values in the columns, such as “Mean Evap-ET”, “DICU Ave Evap(mm)” and “Hist Ave Evap”, could repeat the same values as those in the previous year.</p><p><strong>-</strong>          Save the spreadsheet. Do not close the file. It will be used for updating the precipitation and reference ET for the DICU model.</p><p><strong>3.      </strong><strong>Update the input files in DICU model</strong></p><p><strong>-</strong>          Go to <a href="file:///D:/delta/dsm2_v8/studies/hist2015/DICU/DICU/PRECIP/7STATION-DAT-Y2K" class="external-link" rel="nofollow">DICU/Precip/7STATION-DAT-Y2K</a> , open the Precip input file 7STAPREC.WY20XX. The file saves the monthly precipitation in the water year 20XX at seven stations: Davis, Rio Vista, Brentwood, Tracy, Stockton, Lodi and Galt. CIMIS has not collected the precipitation data at Galt for recent several decades. Update the precipitation with the same station names from the spreadsheet PrecipLookupToDSS, and copy the same precipitation at Lodi into the column of Galt.</p><p><strong>-</strong>          Starting from WY2015, the Lodi West data from CIMIS is missing, so the Lodi precipitation after April 2015 is downloaded from  <a href="http://ipm.ucanr.edu/calludt.cgi/PCSTATIONDATA?MAP=&amp;STN=LODI-01.P1440&amp;SCALE=Daily" class="external-link" rel="nofollow">the National Centers for Environmental Information</a>, University of California Agriculture &amp; Natural Resources (UCANR). Pasted the downloaded Lodi precipitation on the spreadsheet PrecipLookupToDSS.</p><p><strong>-</strong>          Update the Precip file located at DICU/PRECIP/7STATION-DAT-Y2K . If some of the downloaded Lodi data are missing, the precipitation at Stockton can be taken as the substitute, since Stockton is the nearest available station to Lodi.</p><p><strong>-</strong>          Save the Precip file. (If starting a new water year, make sure to copy the file for the next water year with the appropriate name of the next water year + 1 so the average precip information will not be lost!)</p><p><strong>-</strong>          Water year type. Go to <a href="http://cdec.water.ca.gov/cgi-progs/iodir/WSIHIST" class="external-link" rel="nofollow">the website</a> to get the water year type, and go to the folder DICU/DICU5IN1/1922-20**(the current year to update), and update WYTYPES file with textpad.</p><p><strong>-</strong>          Pan evaporation. Go to <a href="file:///D:/delta/dsm2_v8/studies/hist2015/DICU/DICU/PAN-EVAP" class="external-link" rel="nofollow">DICU/PAN_EVAP</a>, update README-2YYY.txt file with the Manteca pan evap (in and mm), AVE EVAP of DICU_YYYYMM.xlsm and ET ADJ FACTR from the “TimeSeries” worksheet of DICU_YYYYMM.xlsm to keep a record of the data used.</p><p><strong>-</strong>          Update DICU5.5 txt file. Go to <u>DICU/DICU5/1922-20**, </u>update DICU5.5 txt file at the bottom. You will want to update the water year type and the ET adjustment factors which are in rows where the values are from column in the “TimeSeries” worksheet of DICU_YYYYMM.xlsm. Also remember this is by water year and the data spacing must not change.<strong> </strong></p><p><strong>4.      </strong><strong>Run DICU</strong></p><p><strong>-</strong>          Go to DICU/DICU5IN1/1922-20**, update dicu5in1.py. The lines marked with “Update here!” must be updated. Open the command window, and run:</p><p>                python dicu5in1.py</p><p><strong>-</strong>          Go to DICU/DICU5/1922-20**, update and run the python script run-dicu5.py. The lines marked with “update folder name” must be updated. Open the command window, and run:</p><p>                python run-dicu5.py</p><p><strong>-</strong>          Go to DICU/NODCU/NODCU12/1922-20**/, update and run the python script bat1922-20**.py. The lines marked with “update folder name”, “update the year”, and “update the month” must be updated. Open the command window, and run:</p><p>                python bat1922-20**.py</p><p><strong>-</strong>           Copy the file DICU_YYYYMM.dss from /DICU/NODCU/NODCU12/1922-20**/ to the folder /timeseries of the DSM2 historical simulation.</p><p><br/></p><h2 id="UpdateDSM2historicalsimulation-Step2:DSM2BoundaryInputsUpdate(underthefolder/DSM2_flow_stage_EC_input)"><strong>Step 2: DSM2 Boundary Inputs Update (under the folder </strong><strong>/DSM2_flow_stage_EC_input)</strong></h2><p><strong>1.      </strong><strong>Boundary inputs from CDEC</strong></p><p><strong>-</strong>          Most DSM2 boundary data can be retrieved from CDEC. The python script Retrieve_data_fromCDEC.py can retrieve the data of CDEC stations as an input text file defines, and write the retrieved data into a DSS file.</p><p>The input text file is a queue of the information of the requested CDEC stations, and each line in the file contains the station ID, sensor number, and duration of one CDEC station.</p><p>The data in the DSS file is the raw data with data gaps frequently. To conduct writing the timeseries in the DSS file without interruptions, they are defined as irregular timeseries.</p><p>Get a command prompt window under the folder /DSM2_flow_stage_EC_input, and type the line below to retrieve the DSM2 boundary data.</p><p>               Python Retrieve_data_fromCDEC.py arg1 arg2 arg3 arg4</p><p>where</p><p>Arg1 – The first argument, the text file of the CDEC station information. To retrieve DSM2 boundaries, Arg1 is <u>Delta_boundaries.txt</u>. The DSM2 boundary flows, stages, and ECs, from CDEC are included in this text file. Table 1 lists the DSM2 boundaries, and their corresponding CDEC stations and related information, which the text file has included. CDEC does not have the DSM2 boundary, Mokelumne River inflow.</p><p>Arg2 – The second argument, the starting date of the data, formatted as mm/dd/yyyy.</p><p>Arg3 – The third argument, the ending date of the data, formatted as mm/dd/yyyy.</p><p>Arg4 – The fourth argument, the name of the DSS file that stores the retrieved data.</p><p>Below is an example to download the DSM inputs from 1/1/2017 through 12/31/2017 and write the retrieved data into a DSS file named as update201712.dss.</p><p>Python Retrieve_data_fromCDEC.py Delta_boundaries.txt 1/1/2017 12/31/2017 update201712.dss</p><p> </p><p>                              <strong>Table 1 The CDEC stations to retrieve data as the DSM2 inputs</strong></p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/><col/><col/><col/></colgroup><tbody><tr><td class="confluenceTd"><p><strong>CDEC station</strong></p></td><td class="confluenceTd"><p><strong>RKI name</strong></p></td><td class="confluenceTd"><p><strong>DSM2 input type</strong></p></td><td class="confluenceTd"><p><strong>Input location</strong></p></td><td class="confluenceTd"><p><strong>Time interval</strong></p></td></tr><tr><td class="confluenceTd"><p>LIS</p></td><td class="confluenceTd"><p>BYOLO040</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>Yolo Bypass</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>YBY</p></td><td class="confluenceTd"><p>BYOLO040</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>Yolo Bypass</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>VNS</p></td><td class="confluenceTd"><p>RSAN112</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>San Joaquin River at Vernalis</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>FPT</p></td><td class="confluenceTd"><p>RSAC155</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>Sacramento River at Freeport</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>NHG</p></td><td class="confluenceTd"><p>RCAL009</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>Calaveras River at Stockton</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>MHB</p></td><td class="confluenceTd"><p>RCSM075</p></td><td class="confluenceTd"><p>flow</p></td><td class="confluenceTd"><p>Cosumnes River at Michigan Bar</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>HRO</p></td><td class="confluenceTd"><p>CHSWP003</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>Banks puming</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>TRP</p></td><td class="confluenceTd"><p>CHDMC004</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>Jones (Tracy) pumping</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>BKS</p></td><td class="confluenceTd"><p>SLBAR002</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>North Bay Aqueduct</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>CCW</p></td><td class="confluenceTd"><p>CHVCT001</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>Middle River pumping</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>IDB</p></td><td class="confluenceTd"><p>ROLD034</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>Old River pumping near Discovery Bay</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>INB</p></td><td class="confluenceTd"><p>CHCCC006</p></td><td class="confluenceTd"><p>export</p></td><td class="confluenceTd"><p>Rock Slough pumping near Brentwood</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>MRZ</p></td><td class="confluenceTd"><p>RSAC054</p></td><td class="confluenceTd"><p>stage</p></td><td class="confluenceTd"><p>Martinez</p></td><td class="confluenceTd"><p>15 MIN</p></td></tr><tr><td class="confluenceTd"><p>MRZ</p></td><td class="confluenceTd"><p>RSAC054</p></td><td class="confluenceTd"><p>EC</p></td><td class="confluenceTd"><p>Martinez</p></td><td class="confluenceTd"><p>1 HOUR</p></td></tr><tr><td class="confluenceTd"><p>SRH</p></td><td class="confluenceTd"><p>RSAC139</p></td><td class="confluenceTd"><p>EC</p></td><td class="confluenceTd"><p>Sacramento River at Hood</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr><tr><td class="confluenceTd"><p>VER</p></td><td class="confluenceTd"><p>RSAN112</p></td><td class="confluenceTd"><p>EC</p></td><td class="confluenceTd"><p>Vernalis</p></td><td class="confluenceTd"><p>1 DAY</p></td></tr></tbody></table></div><p> </p><p><strong>-</strong>          QA/QC of all the data in the DSS file except Martinez stage and EC. Conduct QA/QC and remove errors for those timeseries. Martinez stage and EC will be processed independently after Step 2.</p><p><strong>-</strong>          Use HEC-DSSVue to fill the data gaps. HEC-DSSVue can automatically fill the gaps with several time steps missing by interpolation when converting irregular to regular timeseries. There is another way to fill the gaps with longer intervals. Go to the menu of HEC-DSSVue, and click: Tools-&gt;Math Functions-&gt;General-&gt;Estimate missing values.</p><p><strong>-</strong>          Use HEC-DSSVue to convert the irregular timeseries into regular timeseries. Go to the menu of HEC-DSSVue, and click: Tools-&gt;Math Functions-&gt;Time Functions-&gt;select operator: min/max/avg/…over period -&gt; select function type: average over period -&gt; select new period intervals as Table 1 -&gt; Compute-&gt;save with the default pathnames.</p><p><strong>-</strong>          Copy and paste the file update201712.dss with regular timeseries into the folder /merge_data.</p><p> </p><p><strong>2.      </strong><strong>Retrieve ancillary data from CDEC</strong></p><p><strong>-</strong>          Call the same Python script Retrieve_data_fromCDEC.py to retrieve extra data for QA/QC, filling data gaps at Martinez, and checking the gates operation times. The CDEC stations for fulfilling those functions are listed in the text file, ancillary_stations.txt. Below is an example to download the ancillary data from 1/1/2017 through 12/31/2017 and write the retrieved data into a DSS file named as ancillary201712.dss.</p><p>                Python Retrieve_data_fromCDEC.py ancillary_stations.txt 1/1/2017 12/31/2017 ancillary201712.dss</p><p> </p><p><strong><strong>3.    </strong>Download data from other sources</strong></p><p><strong>-</strong>          San Francisco stage for updating Martinez stage</p><p>Go to the website: <a href="http://tidesandcurrents.noaa.gov/waterlevels.html?id=9414290" class="external-link" rel="nofollow">http://tidesandcurrents.noaa.gov/waterlevels.html?id=9414290</a></p><p>Choose the options:</p><p>                        Units: Feet</p><p>                        Timezone: LST</p><p>                        Datum: MLLW</p><p>                        Interval: Hourly</p><p>                        Update: Data Only</p><p>When the data list shows on the screen, click the button: Export to CSV, to save the data in a csv file. Load the csv data in HEC-DSSVue, and convert its datum from MLLW to NGVD by NGVD = MLLW - 2.64 feet</p><p><strong>-</strong>          Yolo Bypass Flow</p><p>Yolo Bypass is a wide-open area, so it is hard to investigate the actual flows in this region. There is no flow station at the DSM2 boundary location. As a boundary flow in DSM2, Yolo Bypass flow has been assumed to equal the aggregation of the flows collected from those stations near Yolo Bypass, like the Yolo Bypass flow (QYOLO) from <a href="https://www.water.ca.gov/-/media/DWR-Website/Web-Pages/Programs/Environmental-Services/Compliance-Monitoring--Assessment/Dayflow/Files/Publications/Current-Dayflow-Documentation.pdf" class="external-link" rel="nofollow">DAYFLOW</a> as</p><p>                        QYOLO = Yolo Bypass flow at Woodland + Sacramento Weir Spill + South Fork Putah Creek flow</p><p>These three flows can be retrieved from CDEC station YBY, USGS station 11426000(SACRAMENTO WEIR SPILL TO YOLO BYPASS NR SAC CA), and CDEC station PUT.  The last two stations have been inactive for recent years, so YBY is the unique effective station collecting the Yolo Bypass flow.</p><p>However, DSM2 v6.0 historical simulation update tool took the flow at CDEC station RUM (Cache Creek at Rumsey Bridge) as the Yolo Bypass flow. It is not appropriate, especially the inflow to the Sacramento River during summers. Generally, during summers and falls Yolo Bypass has toe drain instead of inflow to the Sacramento River, and during winters and springs it functions as a diversion to reduce the Sacramento River floods.</p><p>DSM2 input data version is based on the timeseries ending time. Starting from the version December 2017 (12/2017), the RUM flow from 2006 through current has been replaced by the available observed flows at YBY and LIS. The old input data versions keep the RUM flow.</p><p>Furthermore, from the version 12/2017, CDEC station LIS flow is taken as the Yolo Bypass flow from June to November every year, while CDEC station YBY flow is taken as the Yolo Bypass flow from December to next May. If the Sacramento River floods diverted into Yolo Bypass come earlier than December or after May, YBY flow might be accounted as the Yolo Bypass flow of the DSM2 inputs in those months.</p><p>The combination of YBY and LIS flows in the file <u>update201712.dss</u> under the folder /DSM2_flow_stage_EC_input is conducted in HEC-DSSVue. Open update201712.dss in HEC-DSSVue, set the time window December 1<sup>st</sup> -May 31<sup>st</sup>, select the daily YBY flow, duplicate the daily YBY flow and rename it as /CDEC/LIS/FLOW//1DAY/20_E/. It overwrites the daily LIS flow from December through May. After that, the daily LIS flow represents Yolo Bypass flow and will be merged with the previous version of DSM2 inputs. </p><p><strong>-</strong>          Mokelumne River flow</p><p>Contact the staff in East Bay Municipal Utility District (EBMUD) directly. Their website only presents the flow at Mokelumne River below WID for the last seven days:</p><p><a href="http://www.ebmud.com/water-and-drought/about-your-water/water-supply/water-supply-reports/daily-water-supply-report/" class="external-link" rel="nofollow">http://www.ebmud.com/water-and-drought/about-your-water/water-supply/water-supply-reports/daily-water-supply-report/</a></p><p>Kevin Fung <a href="mailto:kevin.fung@ebmud.com" class="external-link" rel="nofollow">kevin.fung@ebmud.com</a> has been contacted for the past several years and provided the raw data of the current year.</p><p>The QA/QC’d Mokelumne River flow of the previous years, which EBMUD sent to USGS, can be downloaded from USGS website.</p><p>Once Mokelumne River flow is received, use HEC-DSSVue to load and save it in the DSS file /DSM2_flow_stage_EC_input/updateYYYYMM.dss. Here MM and YY/YYYY are the month and year of the updated version, and set the pathname of this time series as</p><p>/FILL+CHAN/RMIL070/FLOW//1DAY/DWR-DMS-YYYYMM/</p><h2 id="UpdateDSM2historicalsimulation-Step3:MartinezboundariesUpdate"><strong>Step 3: Martinez boundaries Update</strong></h2><p><strong>1.      </strong><strong>Martinez Stage (DATUM: NAVD88; under the folder /MTZ_stage_EC/fill_stage)</strong></p><p><strong>-</strong>          Remove stage data errors. Copy Martinez CDEC stage from /DSM2_flow_stage_EC_inputs/update201712.dss to a new DSS file, for example MTZ_201712.dss, under the folder /MTZ_stage_EC/fill_stage. Check the data in the file MTZ_201712.dss, remove errors in the stage timeseries, record the time window of each data gap at the end of the text file input.txt, and delete the out-of-date time windows in the file input.txt.</p><p><strong>-</strong>          One hour shift of Daylight saving time. Compare the astronomical tide and CDEC retrieved stage at Martinez, select the time window of one hour shift due to Daylight saving time, and shift one hour to match the phases of astronomical tides. The time shift can be conducted in HEC-DSSVue under the menu Tools -&gt; Math Functions -&gt;Time Functions -&gt; Operator: Shift in Time. Record the data gaps in March and November at the end of input.txt because of the time shift.</p><p><strong>-</strong>          Prepare the input file. Prepare the input text file (input.txt) for the python script (fillgaps.py) to fill the stage gaps. Below is an example of the file input.txt. It includes the data version(tmark), names of input and output DSS files, the pathnames of timeseries used in this gap filing, and the time windows of the stage data gaps found. The time windows are suggested to be longer than one day or two days to fill the gaps smoothly.      </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="400" src="attachments/87228633/87228635.png" data-image-src="attachments/87228633/87228635.png" data-unresolved-comment-count="0" data-linked-resource-id="87228635" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="sample_file_1.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228633" data-linked-resource-container-version="1"></span>                                          </p><p><strong>-</strong>          Run the python script:</p><p>Python fillgaps.py input.txt</p><p> </p><p><strong>2.      </strong><strong>Martinez EC (under the folder /MTZ_stage_EC /fill_EC)</strong></p><p><strong>-</strong>          Remove the errors in the observed 15-minute EC data. Copy Martinez 15-minute EC data from /DSM2_flow_stage_EC_inputs/update201712.dss to a new DSS file, for example MTZ_201712.dss, under the folder /MTZ_stage_EC/fill_EC. Open MTZ_201712.dss, find and remove the errors in the Martinez 15-minute EC data, and record the data gaps in the text files .\timewindows_ec_ave.txt.</p><p><strong>-</strong>          Average the filtered 15min MRZ EC to hourly MRZ EC and save part F of the pathname as /100_E_AVE/. Then the hourly MRZ EC has the pathname as</p><p>/CDEC/MRZ/EC//1HOUR/100_E_AVE/</p><p><strong>-</strong>          Copy Mallard hourly and daily EC data from /DSM2_flow_stage_EC_inputs/ ancillary201712.dss to the same DSS file /MTZ_stage_EC/fill_EC/MTZ_201712.dss.</p><p><strong>-</strong>          Calculate NDOI by combining 6 inflows, 6 exports and Delta consumptive use.</p><p>1)      In the file /DSM2_flow_stage_EC_input/updateYYYYMM.dss, use HEC-DSSVue to sum up the six inflows into one total inflow with the pathname</p><p>Path1: /CDEC/TOTAL/FLOW//1DAY/20_H/.</p><p>The pathnames of the inflows are listed below,</p><p>Sacramento inflow:   /CDEC/FPT/FLOW//1DAY/20_H/</p><p>San Joaquin inflow:   /CDEC/VNS/FLOW//1DAY/20_E/</p><p>Yolo Bypass inflow:   /CDEC/LIS/FLOW//1DAY/20_E/</p><p>Calaveras inflow:       /CDEC/NHG/FLOW//1DAY/23_H/</p><p>Cosumnes inflow:      /CDEC/MHB/FLOW//1DAY/20_H/</p><p>Mokelumne inflow:   /FILL+CHAN/RMIL070/FLOW//1DAY/DWR-DMS-YYYYMM/</p><p>2)      Also sum up the six exports into one total export with the pathname</p><p>Path2: /CDEC/TOTAL/FLOW_EXPORT//1DAY/70_D/.</p><p>The pathnames of the six exports are listed below,</p><p>SWP:                                        /CDEC/HRO/FLOW_EXPORT//1DAY/70_D/</p><p>CVP:                                         /CDEC/TRP/FLOW_EXPORT//1DAY/70_D/</p><p>North Bay aqueduct:               /CDEC/BKS/EXPORT//1DAY/70_D/</p><p>Old River near Brentwood:     /CDEC/INB/FLOW_EXPORT//1DAY/70_D/</p><p>Old River near discovery bay: /CDEC/IDB/FLOW_EXPORT//1DAY/70_D/</p><p>Middle River:                          /CDEC/CCW/FLOW_EXPORT//1DAY/70_D/</p><p>3)      Calculate the total inflow Path1 minus the total export Path2, and save it as the timeseries with the pathname</p><p>Path3: /CDEC/TOTAL/FLOW //1DAY/INFLOWS-EXPORTS/</p><p>4)      Copy the timeseries with Path3 to the DSS file /MTZ_stage_EC/fill_EC/MTZ_201712.dss</p><p>5)      Copy the latest version of dicu_YYYYMM.dss from the folder /DICU/NODCU/NODCU12/1922-2017 to the folder /MTZ_stage_EC/fill_EC.</p><p>6)      Use HEC-DSSVue to open file /MTZ_stage_EC/fill_EC /dicu_YYYYMM.dss, and sum up all the timeseries with part C DIV-FLOW to one timeseries with</p><p>Path 4: /DICU-HIST+NODE/TOTAL/DIV-FLOW//1MON/DWR-BDO/</p><p>7)      Sum up all the timeseries with part C DRAIN-FLOW to one timeseries with</p><p>Path 5: /DICU-HIST+NODE/TOTAL/DRAIN-FLOW//1MON/DWR-BDO/</p><p>8)      Sum up all the timeseries with part C SEEP-FLOW to one timeseries with</p><p>Path 6: /DICU-HIST+NODE/TOTAL/SEEP-FLOW//1MON/DWR-BDO/</p><p>9)      Calculate Delta consumptive use by Path 4+Path6-Path5, and save it as one timeseries with the pathname</p><p>Path 7: /DICU-HIST+NODE/TOTAL/FLOW//1MON/DWR-BDO/</p><p>10)  Convert the timeseries with path 7 into daily data,</p><p>Path 8: /DICU-HIST+NODE/TOTAL/FLOW//1DAY/DWR-BDO/</p><p>and copy the daily one to the DSS file MTZ_stage_EC/fill_EC/MTZ_201712.dss</p><p>11)  Open file MTZ_201712.dss, and calculate NDOI by subtracting the timeseries with Path8 from that with Path 3. The NDOI data has the pathname</p><p>Path 9: &quot;/FILL+CHAN/NDOI/FLOW//1DAY/ DWR-DMS-YYYYMM/</p><p>Here YYYY and MM are the year and month of the updated version.</p><p><strong>-</strong>          Prepare the input file. Prepare the input text file, such as timewindows_ec_ave.txt, for the python script (fillgaps_ec.py) to fill the EC gaps. Below is an example of the file timewindows_ec_ave.txt. It includes the data version(tmark), names of input and output DSS files, and the time windows of the data gaps found.   </p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image confluence-thumbnail" width="200" src="attachments/87228633/87228634.png" data-image-src="attachments/87228633/87228634.png" data-unresolved-comment-count="0" data-linked-resource-id="87228634" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="MRZ_EC_input.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228633" data-linked-resource-container-version="1"></span>               </p><p><strong>-</strong>          Run the Python script, and obtain the output file filled.dss.</p><p>                Python fillgaps_ec.py timewindows_ec_ave.txt</p><p> </p><p><strong>3.      </strong><strong>Merge the updated data and the previous version of DSM2 input data</strong></p><p><strong>-</strong>          After the data gaps have been filled, copy QA/QC’d Martinez 15-minute stage and 1-hour EC from the folders /MTZ_stage_EC/fill_EC and /MTZ_stage_EC/fill_stage into the file \DSM2_flow_stage_EC_inputs\updateYYYYMM.dss.</p><p><strong>-</strong>          When all the input timeseries have been QA/QC’d, the previous version of DSM2 input data must be extended with the updated data.  in the file \DSM2_flow_stage_EC_inputs\updateYYYYMM.dss. Copy the previous version of DSM2 input data, histMMYY.dss, into the folder \merge_data, update the names of merged files, the name of output file, and the versions in the file pathnames.txt, and run the Python script:</p><p>                Python merge_data.py pathnames.txt</p><p><strong>-</strong>          Check all the pathnames in the latest version match those in DSM2 inp files.</p><h2 id="UpdateDSM2historicalsimulation-Step4:Gateoperationsupdate(underthefolder\gateoperations)"><strong>Step 4: Gate operations update (under the folder \gateoperations)</strong></h2><p><strong>1.      Delta Cross Channel</strong></p><p>Download the gate operations from <a href="https://www.usbr.gov/mp/cvo/vungvari/Ccgates.pdf" class="external-link" rel="nofollow">https://www.usbr.gov/mp/cvo/vungvari/Ccgates.pdf</a></p><p><strong>2.      Clifton Court gate</strong></p><p>Ask Liu, Siqing (<span><a href="mailto:Siqing.Liu@water.ca.gov" class="external-link" rel="nofollow">Siqing.Liu@water.ca.gov</a></span>) from O&amp;M. O&amp;M collects the inputs without QA/QC and updates DSM2 monthly, so their inputs can be taken as the preliminary inputs.</p><p><strong>3.      South Delta temporary barriers and Montezuma Slough gate</strong></p><p>Go to <a href="http://baydeltaoffice.water.ca.gov/sdb/tbp/web_pg/tempbsch.cfm" class="external-link" rel="nofollow">http://baydeltaoffice.water.ca.gov/sdb/tbp/web_pg/tempbsch.cfm</a>, or ask Michal Burn, South Delta Section to get the temporary barriers gate operations, or ask O&amp;M. The available values of the gate parameters are listed in the file \gateoperations\barriers_values_03082012.xlsx. The Vertical Datum in the Excel file is NGVD29, while that in the gate operation DSS file is NAVD88. When the DSS file is updated, the Datum difference must be counted.</p><p><strong>4.     </strong> <strong>Tune the gate operation times</strong></p><p>All the information of gate operations collected above are added in \gateoperations\gate-v8-YYYYMM.dss. The collected gate operation schedules are normally not the actual gate operations. After all the inputs of DSM2 historical simulation are prepared, pre-run DSM2 HYDRO and check if the simulated upstream and downstream stages/flows of each gate match the observed stages/flows. If not, tune the gate operation times until the simulated stage variations in time reflect the gate operation schedules accurately. Table 2 is the list of CDEC stations to check the gate operation schedules. CDEC stages or flows in the table have been downloaded and saved in the file ancillary201712.dss in Step 2.  </p><p> </p><p>                    Table 2 The CDEC stations to check gate operations</p><div class="table-wrap"><table class="confluenceTable"><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td colspan="2" class="confluenceTd"><p>Barriers</p></td><td class="confluenceTd"><p>RKI or Channel No</p></td><td class="confluenceTd"><p>CDEC station</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>Old River @ Head</p></td><td class="confluenceTd"><p>Upstream</p></td><td class="confluenceTd"><p>Mossdale</p></td><td class="confluenceTd"><p>MSD</p></td></tr><tr><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>Channel 55, ROLD074</p></td><td class="confluenceTd"><p> OH1</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>Old River at Tracy</p></td><td class="confluenceTd"><p>Upstream</p></td><td class="confluenceTd"><p>ROLD047</p></td><td class="confluenceTd"><p>OAD</p></td></tr><tr><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>ROLD046</p></td><td class="confluenceTd"><p>OBD</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>Grant Line Canal</p></td><td class="confluenceTd"><p>Upstream</p></td><td class="confluenceTd"><p>Channel 205</p></td><td class="confluenceTd"><p>DGL</p></td></tr><tr><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>CHGRL009</p></td><td class="confluenceTd"><p>GLC</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>Middle River</p></td><td class="confluenceTd"><p>Upstream</p></td><td class="confluenceTd"><p>RMID027</p></td><td class="confluenceTd"><p>MTB</p></td></tr><tr><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>Channel 135</p></td><td class="confluenceTd"><p>No station</p></td></tr><tr><td class="confluenceTd"><p>Delta Cross Channel</p></td><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>Channel 365</p></td><td class="confluenceTd"><p>DLC</p></td></tr><tr><td rowspan="2" class="confluenceTd"><p>Montezuma Slough</p></td><td class="confluenceTd"><p>Upstream</p></td><td class="confluenceTd"><p>Collinsville at Sac. River</p></td><td class="confluenceTd"><p>CSE</p></td></tr><tr><td class="confluenceTd"><p>Downstream</p></td><td class="confluenceTd"><p>Roaring River</p></td><td class="confluenceTd"><p>MSL</p></td></tr></tbody></table></div><p> </p><p><br/></p><p><br/></p><p><br/></p>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228633/87228632.png">plots_for_chapters.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228633/87228634.png">MRZ_EC_input.png</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228633/87228635.png">sample_file_1.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
