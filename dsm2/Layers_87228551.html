<!DOCTYPE html>
<html>
    <head>
        <title>DSM2 version 8.2 : Layers</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DSM2 version 8.2</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2_87228545.html">DSM2</a></span>
                            </li>
                                                    <li>
                                <span><a href="Documentation_87228546.html">Documentation</a></span>
                            </li>
                                                    <li>
                                <span><a href="DSM2-Overview_87228548.html">DSM2 Overview</a></span>
                            </li>
                                                    <li>
                                <span><a href="Organizing-a-Study_87228549.html">Organizing a Study</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DSM2 version 8.2 : Layers
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicky Sandhu</span> on Jan 27, 2021
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <div><h2 id="Layers-Overview:">Overview:</h2><p>DSM2 batches input data into files or &quot;layers&quot; in order to achieve the following goals:</p><ul><li>To group input into cohesive packages with similar content(examples: the standard grid, sdip operating rules).</li><li>To identify which items are changed when a new group of inputs is added to an existing simulation.</li></ul><p>For example, consider the two layers of channels in the figure below. The first layer defines seven channels and would have seven entries in the CHANNEL table. This might represent a &quot;base&quot; grid. The second layer changes the properties of Channel 2, adds a Channel 8 and removes Channel 7. The second layer will have only three entries, shown in red. These entries represent the changes relative to Layer 1, and presumably are thematically related.</p><p><br/></p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image" height="250" src="attachments/87228551/87228550.png" data-image-src="attachments/87228551/87228550.png" data-unresolved-comment-count="0" data-linked-resource-id="87228550" data-linked-resource-version="1" data-linked-resource-type="attachment" data-linked-resource-default-alias="layer_system.png" data-base-url="http://msb-confluence" data-linked-resource-content-type="image/png" data-linked-resource-container-id="87228551" data-linked-resource-container-version="1"></span></p><hr class="table_sep"/><h3 id="Layers-Example:Channel">Example: Channel</h3><p>Consider the above example using text input. We are going to create<a rel="nofollow">CHANNEL</a> tables representing the channel connectivity, and assume the geometry is provided with CSDP style cross-sections listed in an <a rel="nofollow">XSECT</a> table (child items are always associated with parent items in the same file).</p><p>The base data will be in a file <em>channel_base.inp</em>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b> channel_base.inp</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence">CHANNEL
CHAN_NO LENGTH MANNING DISPERSION UP_NODE DOWN_NODE
1        18000   0.030       0.80       1         2
2         8000   0.040       0.80       2         3
3        18000   0.040       0.80       3         4
4        18000   0.040       0.80       4         5
5        18000   0.040       0.80       3         5
6        22000   0.040       0.80       5         6
7        14000   0.040       0.80       6         7
END

XSECT
CHAN_NO   DISTANCE    FILE
1         0.200       1_0_200.txt
1         0.800       1_0_800.txt
2         0.500       2_0_500.txt
...
7         0.900       7_0_900.txt
END</pre>
</div></div><p><br/></p><p>The revisions are in <em>channel_revise.inp</em>:</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>channel_revise.inp</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence">CHANNEL
CHAN_NO LENGTH MANNING DISPERSION UP_NODE DOWN_NODE
2         8000   0.030       0.80       2         3 # Masks + Alters
#3        9000   0.000       0.00      19        20 # Has no effect
^7       14000   0.040       0.80       6         7 # Masks + Deletes
...
8        16000   0.040       0.80       8         3 # Adds
END

XSECT
CHAN_NO DISTANCE  FILE
2          0.100  2_0_500.txt  # Masks lower level x-sects 
2          0.700  2_0_500.txt  #
7          0.900  7_0_900.txt  # Will be ignored
8          0.500  8_0_500.txt  # 
END</pre>
</div></div><p><br/></p><p>The two layers are managed by the model input file that is given directly to the model, in this case <em>hydro_layering.inp</em>. The two channel files are listed in a GRID include block that lists the layers in increasing priority.</p><div class="code panel pdl" style="border-width: 1px;"><div class="codeHeader panelHeader pdl" style="border-bottom-width: 1px;"><b>hydro.inp</b></div><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: text; gutter: false; theme: Confluence" data-theme="Confluence">GRID
channel_base.inp
channel_revise.inp
END</pre>
</div></div><p><br/></p><p>Now lets consider the details...</p><br/><h4 id="Layers-IncludeBlocks">Include Blocks</h4><p>Include blocks are input blocks in the master file that list other files. The data from these other files is &quot;included&quot; in the order listed. Priority is given to files read later, and these are assigned a higher &quot;layer number&quot;</p><p>Include blocks can only contain specific types of input data. For instance, a GRID input block only contains channel, gate, reservoir and transfer physical specifications (not boundary conditions attached to them). So the trick to using include blocks is knowing, say, that a CHANNEL table belongs in a file in a GRID include block and BOUNDARY_FLOW table belongs in a file in a HYDRO_TIME_SERIES block. In the reference documentation, the include blocks should be listed for each table in the <em>Table Information</em> section..</p><p>The only exception is the master file that is the one sent to the model on the command line (often named something like hydro.inp, qual.inp, ptm.inp). Data in this file always take precedence over other input.</p><h3 id="Layers-LayerOverriding">Layer Overriding</h3><p>Layer overriding occurs when the same data item is defined in multiple layers (files) in the same model. Files that are read later are given a higher &quot;layer number&quot; and take precendence over files read earlier. Within the same file it is an error to redefine an entry.</p><h4 id="Layers-Identifiers">Identifiers</h4><p>To use layering, you have to know what constitutes redefining an entry. Whether two items represent the same data item depends on the identifier for the table, which is some combination of columns that uniquely identify the item using a name or number. Identifiers for each table are listed in the reference documents. In the above example it is channel number CHAN_NO. The trickiest identifiers are in the output, because they involve two (NAME, VARIABLE) or three (NAME, VARIABLE,SOURCE_NAME) columns. In the reference documentation, the identifier is listed for each table in the <em>Table Information</em> section.</p><h4 id="Layers-Parent-childTables">Parent-child Tables</h4><p>When parent-child tables are present in a file (e.g., Channels, Cross Section, Cross Section Layer), overriding is assessed at the level of the parent or <em>top-level table</em>. When you override on a top-level table, its child table information is completely replaced as well. So, for instance, the cross-section at Channel 2 Distance 0.500 in channel_base.inp in the example is completely ignored. The model makes no attempt to &quot;mix it in&quot; with the replacement version of Channel 2.</p><p>Child tables must be in the same file as their parent tables. This is a departure from earlier versions of DSM2, but is necessary to make layering well-defined.</p><h4 id="Layers-Deletinglowerleveldata">Deleting lower level data</h4><p>Occasionally, the motivation for overriding an item is to eliminate it. You can do this on any top-level table by prepending a carat ^ at the beginning of the line. This will remove items on lower levels with the same identifier. Note that it doesn't matter what other data you put in the parent fields (you do need placeholders). Also you needn't add child information if the only reason for the parent entry is to delete it -- but sometimes it is nice to have the child data there if you are toggling back and forth.</p><p>Deleting data is quite different from commenting it out (using a # sign). Commenting data out on a high level would merely mean that the input reader would skip over the line. It would not affect any data with the same identifier on a lower level.</p><p><div style="page-break-before:always;" /></p></div>
                    </div>

                                                            <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/87228551/87228550.png">layer_system.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on May 16, 2023 11:04</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
